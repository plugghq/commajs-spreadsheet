!function(e,t){"object"==typeof exports&&"object"==typeof module?module.exports=t(require("commajs-core")):"function"==typeof define&&define.amd?define(["commajs-core"],t):"object"==typeof exports?exports.CommaSpreadsheet=t(require("commajs-core")):e.CommaSpreadsheet=t(e["commajs-core"])}(window,function(__WEBPACK_EXTERNAL_MODULE__0__){return d=[function(e,t){e.exports=__WEBPACK_EXTERNAL_MODULE__0__},function(e,t,n){"use strict";function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function o(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}function l(e,t,n){return t&&o(e.prototype,t),n&&o(e,n),e}n.d(t,"a",function(){return a});var m=function(){function u(e){r(this,u),this.date=e,this.patterns=["YYYY","YY","MMMM","MMM","MM","M","DD","D","EE","E"],this.months=["January","February","March","April","May","June","July","August","September","October","November","December"],this.monthsShort=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sept","Oct","Nov","Dec"],this.daysOfTheWeek=["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],this.daysOfTheWeekShort=["Sun","Mon","Tue","Wed","Thu","Fri","Sat"]}return l(u,[{key:"_replaceAll",value:function(e,t,n){return e.replace(new RegExp(t,"g"),n)}},{key:"patternToString",value:function(e){var t="";return"YYYY"==e?t=this.date.getFullYear():"YY"==e?t=this.date.getFullYear().toString().substring(2):"MMMM"==e?t=this.months[this.date.getMonth()]:"MMM"==e?t=this.monthsShort[this.date.getMonth()]:"MM"==e?t=(t=parseInt(this.date.getMonth())+1)<10?"0"+t:t.toString():"M"==e?t=parseInt(this.date.getMonth())+1:"DD"==e?t=(t=this.date.getDate())<10?"0"+t:t.toString():"D"==e?t=this.date.getDate():"EE"==e?t=this.daysOfTheWeek[this.date.getDay()]:"E"==e&&(t=this.daysOfTheWeekShort[this.date.getDay()]),t}},{key:"toString",value:function(t){var n=this,o=0;this.patterns.forEach(function(e){-1<t.indexOf(e)&&(t=n._replaceAll(t,e,"#"+o+"#")),o++});var r="";return t.split("#").forEach(function(e){var t;""!=e&&(t=parseInt(e),isNaN(t)?r+=e:r+=n.patternToString(n.patterns[t]))}),r}}],[{key:"fromString",value:function(e,t,n){var o,r,l,i,a=1<arguments.length&&void 0!==t&&t,s=2<arguments.length&&void 0!==n?n:"en",c=e.split(" ")[0].split("/");return c.length<2&&(c=e.split(" ")[0].split("-")),c.length<2?void 0:(o=parseInt(c[0]),r=parseInt(c[1]),l=parseInt(c[2]),"en"==s||"??"==s&&(o=parseInt(c[1]),r=parseInt(c[0]),l=parseInt(c[2])),a&&(i=new Date,isNaN(o)&&(o=i.getMonth()+1),isNaN(r)&&(r=i.getDate()),isNaN(l)&&(l=i.getFullYear())),isNaN(o)||isNaN(r)||isNaN(l)?void 0:(l<100&&(l=2e3+l),new u(new Date(o+"/"+r+"/"+l))))}}]),u}(),i=function(){function o(e){r(this,o),this.spreadsheet=e,this.availableDateFormats=[{format:"D-MMM",label:"1-Dec"},{format:"D-MMM-YYYY",label:"1-Dec-2019"},{format:"D-MMM-YY",label:"1-Dec-19"},{format:"MM/DD/YYYY",label:"12/01/2019"},{format:"MM/DD/YY",label:"12/01/19"},{format:"MM-DD-YYYY",label:"12-01-2019"},{format:"MM-DD-YY",label:"12-01-19"},{format:"MMM D, YYYY",label:"Dec 1, 2019"},{format:"MMM D, YY",label:"Dec 1, 19"},{format:"MMMM D, YYYY",label:"December 1, 2019"},{format:"D MMMM, YYYY",label:"1 December, 2019"},{format:"D MMMM, YYYY",label:"1 December 2019"},{format:"EE, MMMM D, YY",label:"Sunday, December 1, 19"},{format:"E, MMMM D, YY",label:"Sun, December 1, 19"}],this.format={type:"number"};var t,n={precision:2,dateFormat:""};0<this.spreadsheet.selectedNodes.length&&(null!=(t=this.spreadsheet.selectedNodes[0].domElement.getAttribute("cell-format"))&&""!=t&&(this.format=JSON.parse(t),"number"==this.format.type?n.precision=this.format.params.precision:"date"==this.format.type?n.dateFormat=this.format.params.dateFormat:this.format.type)),this.format.params=n,this.Show()}return l(o,[{key:"Destroy",value:function(){this.panel.parentNode.removeChild(this.panel)}},{key:"VerifyAnPrepareFormat",value:function(){var e=!1;return null!=this.format&&""!=this.format&&("text"==this.format.type?e=!0:"number"==this.format.type?null==this.format.params.precision||""==this.format.params.precision?e=!(this.errorBox.textContent="Decimal places cannot be empty"):a.isNumber(this.format.params.precision)?(e=!0,delete this.format.params.dateFormat):e=!(this.errorBox.textContent="Decimal places must be a number"):"date"==this.format.type&&(e=null!=this.format.params.dateFormat&&""!=this.format.params.dateFormat||!(this.errorBox.textContent="Select date format"),delete this.format.params.precision)),e}},{key:"Apply",value:function(){var t,n,o=this;this.VerifyAnPrepareFormat()&&(t=JSON.stringify(this.format),n=void 0,this.spreadsheet.selectedNodes.forEach(function(e){n=e,"text"==o.format.type?(e.children.forEach(function(e){e.isBlockNode()&&e.ToggleStyle("align","left",!0)}),e.domElement.removeAttribute("cell-format")):(e.children.forEach(function(e){e.isBlockNode()&&e.ToggleStyle("align","right",!0)}),e.domElement.setAttribute("cell-format",t)),a.Format(e)}),null!=n&&n.GetFirstTextNode().SetFocus(),this.panel.parentNode.removeChild(this.panel))}},{key:"_initNavPanel",value:function(){var n=this,e=document.createElement("div");e.style="width:90px;height:300px;background-color:#666666;box-sizing:border-box;padding:20px 0px 10px 10px;";function t(e){e.style.color="#FF9100"}function o(e,t){t==n.format.type?e.style.color="#666666":e.style.color="#ffffff"}function r(e,t){t!=n.format.type&&("number"==n.format.type?(n.numberNavBtn.style.color="#ffffff",n.numberNavBtn.style.backgroundColor="#666666"):"date"==n.format.type?(n.dateNavBtn.style.color="#ffffff",n.dateNavBtn.style.backgroundColor="#666666"):"text"==n.format.type&&(n.textNavBtn.style.color="#ffffff",n.textNavBtn.style.backgroundColor="#666666"),n.format.type=t,e.style.color="#666666",e.style.backgroundColor="#ffffff","number"==n.format.type?(n.numbersOptionsPnl.style.display="block",n.dateOptionsPnl.style.display="none",n.textOptionsPnl.style.display="none"):"date"==n.format.type?(n.numbersOptionsPnl.style.display="none",n.dateOptionsPnl.style.display="block",n.textOptionsPnl.style.display="none"):"text"==n.format.type&&(n.numbersOptionsPnl.style.display="none",n.dateOptionsPnl.style.display="none",n.textOptionsPnl.style.display="block"))}var l="color:#ffffff;font-size:14px;cursor:pointer;margin-bottom:2px;background-color:#666666;padding:6px;border-radius: 6px 0px 0px 6px;",i=document.createElement("div");i.style=l,i.textContent="Number",i.addEventListener("mouseover",function(){t(this)}),i.addEventListener("mouseout",function(){o(this,"number")}),i.addEventListener("click",function(){r(this,"number")}),this.numberNavBtn=i,e.appendChild(i);var a=document.createElement("div");a.style=l,a.textContent="Date",a.addEventListener("mouseover",function(){t(this)}),a.addEventListener("mouseout",function(){o(this,"date")}),a.addEventListener("click",function(){r(this,"date")}),this.dateNavBtn=a,e.appendChild(a);var s=document.createElement("div");return s.style=l,s.textContent="Text",s.addEventListener("mouseover",function(){t(this)}),s.addEventListener("mouseout",function(){o(this,"text")}),s.addEventListener("click",function(){r(this,"text")}),this.textNavBtn=s,e.appendChild(s),"number"==this.format.type?(this.numberNavBtn.style.color="#666666",this.numberNavBtn.style.backgroundColor="#ffffff"):"date"==this.format.type?(this.dateNavBtn.style.color="#666666",this.dateNavBtn.style.backgroundColor="#ffffff"):"text"==this.format.type&&(this.textNavBtn.style.color="#666666",this.textNavBtn.style.backgroundColor="#ffffff"),e}},{key:"_initOptionsPanel",value:function(){var n=this,e=document.createElement("div");e.style="height:230px;overflow:auto;box-sizing:border-box;";var t="display:none;overflow:auto;padding:10px 20px 20px 20px;",o=document.createElement("div");o.style=t;var r=document.createElement("div");r.style="display:flex;justify-content:flex-start;align-items:center;";var l=document.createElement("div");l.style="font-size:14px;color:#39434d;margin-right:10px;",l.textContent="Decimal places: ",r.appendChild(l);var i=document.createElement("input");i.style="display: block;padding:4px;font-size:14px;color:#39434d;border:1px solid #e3e3e3;border-radius:4px;width:30px;",i.value=this.format.params.precision,i.addEventListener("keyup",function(){n.format.params.precision=i.value}),r.appendChild(i),o.appendChild(r),this.numbersOptionsPnl=o,e.appendChild(o);var a=document.createElement("div");a.style=t;var s=document.createElement("div");s.style="font-size:14px;color:#39434d;margin-bottom:4px;",s.textContent="Date Format:",a.appendChild(s);var c=document.createElement("select");c.size="5",c.style="display: block;padding:6px;font-size:12px;color:#39434d;border:1px solid #e3e3e3;border-radius:4px;width:200px;",this.availableDateFormats.forEach(function(e){var t=document.createElement("option");n.format.params.dateFormat==e.format&&t.setAttribute("selected",""),t.value=e.format,t.textContent=e.label,c.appendChild(t)}),c.addEventListener("change",function(){n.format.params.dateFormat=n.availableDateFormats[c.selectedIndex].format}),a.appendChild(c),this.dateOptionsPnl=a,e.appendChild(a);var u=document.createElement("div");u.style=t;var d=document.createElement("div");return d.style="font-size:14px;color:#39434d;",d.textContent="Text format cells are treated as text even when a number is in the cell. The cell is displayed exactly as entered.",u.appendChild(d),this.textOptionsPnl=u,e.appendChild(u),"number"==this.format.type?this.numbersOptionsPnl.style.display="block":"date"==this.format.type?this.dateOptionsPnl.style.display="block":"text"==this.format.type&&(this.textOptionsPnl.style.display="block"),e}},{key:"Show",value:function(){var e=this,t=document.createElement("div");t.style="z-index: 99999999999;position:fixed;display:flex;background-color:rgba(33, 33, 33, 0.5);top:0px;left:0px;width:100vw;height:100vh;justify-content:center;align-items:center;";var n=document.createElement("div");n.style="font-family:Arial;width:500px;height:300px;display:flex;justify-content:center;align-items:center;border-radius:6px;overflow:hidden;",n.appendChild(this._initNavPanel());var o=document.createElement("div");o.style="height:300px;background-color:#ffffff;flex:1;box-sizing:border-box;";var r=document.createElement("div");r.style="display:flex;justify-content:center;align-items:center;padding:6px;";var l=document.createElement("div");l.style="flex:1",r.appendChild(l);var i=document.createElement("i");i.style="color:#666666;font-size:20px;cursor:pointer",i.setAttribute("class","fa fa-times"),i.addEventListener("mouseover",function(){i.style.color="#FF9100"}),i.addEventListener("mouseout",function(){i.style.color="#666666"}),i.addEventListener("click",function(){e.Destroy()}),r.appendChild(i),o.appendChild(r),o.appendChild(this._initOptionsPanel());var a=document.createElement("div");a.style="display:flex;justify-content:center;align-items:center;padding:6px;";var s=document.createElement("div");s.style="flex:1;font-size:12px;color:#f04f4f;",s.textContent="",this.errorBox=s,a.appendChild(s);var c=document.createElement("div");c.style="color:#ffffff;font-size:14px;cursor:pointer;background-color: #30b7e8;padding:4px 8px 4px 8px;border-radius:4px;",c.textContent="Apply",c.addEventListener("mouseover",function(){c.style.backgroundColor="#FF9100"}),c.addEventListener("mouseout",function(){c.style.backgroundColor="#30b7e8"}),c.addEventListener("click",function(){e.Apply()}),a.appendChild(c),o.appendChild(a),n.appendChild(o),t.appendChild(n),document.body.appendChild(t),this.panel=t}}]),o}(),a=function(){function p(){r(this,p)}return l(p,null,[{key:"isNumber",value:function(e){var t=e;return"-"==e[0]&&(t=e.replace("-","")),"."!=e[e.length-1]&&/^[0-9.]*$/.test(t)}},{key:"Format",value:function(e,t){var n,o,r,l,i,a,s,c,u,d,h=1<arguments.length&&void 0!==t&&t,f=e.domElement.getAttribute("cell-format");h&&((n=e.document.GetCursorPosition()).startOffset,n.endOffset),null!=f&&""!=f&&("number"==(f=JSON.parse(f)).type?null==(o=f.params.precision)||""==o||""!=(l=(r=e.GetFirstTextNode()).domElement.textContent.replace(/[\u200B-\u200D\uFEFF]/g,""))&&(o=parseInt(o),i="",p.isNumber(l)&&(i=Number.parseFloat(l).toFixed(o)),l.toString()!=i.toString()&&(r.ForceTextContent(i.toString()),h&&r.SelectText(void 0,void 0))):"date"!=f.type||null!=(a=f.params.dateFormat)&&""!=a&&(""==(c=(s=e.GetFirstTextNode()).domElement.textContent.replace(/[\u200B-\u200D\uFEFF]/g,""))||null!=(u=m.fromString(c,!0))&&(d=u.toString(a),c.toString()!=d.toString()&&(s.ForceTextContent(d.toString()),h&&s.SelectText(void 0,void 0)))))}},{key:"OpenFormatDialog",value:function(e){new i(e)}}]),p}()},function(module,__webpack_exports__,__webpack_require__){"use strict";__webpack_require__.d(__webpack_exports__,"a",function(){return FunctionsManager});var _CellFormatter__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__(1);function _toConsumableArray(e){return _arrayWithoutHoles(e)||_iterableToArray(e)||_unsupportedIterableToArray(e)||_nonIterableSpread()}function _nonIterableSpread(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function _unsupportedIterableToArray(e,t){if(e){if("string"==typeof e)return _arrayLikeToArray(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?_arrayLikeToArray(e,t):void 0}}function _iterableToArray(e){if("undefined"!=typeof Symbol&&Symbol.iterator in Object(e))return Array.from(e)}function _arrayWithoutHoles(e){if(Array.isArray(e))return _arrayLikeToArray(e)}function _arrayLikeToArray(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,o=new Array(t);n<t;n++)o[n]=e[n];return o}function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _defineProperties(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}function _createClass(e,t,n){return t&&_defineProperties(e.prototype,t),n&&_defineProperties(e,n),e}var CommaMath=function(){function u(){_classCallCheck(this,u)}return _createClass(u,null,[{key:"isFunction",value:function(e){return!(["sum","sin","cos","round","pow","sqrt","abs","ceil","floor","min","max","exp","ln","log","avg","count","stdev","concatenate","len"].indexOf(e.toLowerCase())<0)}},{key:"getFunctionType",value:function(e){return"concatenate"==e?"string":"number"}},{key:"getFunctionName",value:function(e){var t="";return"sum"==(e=e.toLowerCase())?t="sum":"sin"==e?t="sin":"cos"==e?t="cos":"round"==e?t="round":"pow"==e?t="pow":"sqrt"==e?t="sqrt":"abs"==e?t="abs":"ceil"==e?t="ceil":"floor"==e?t="floor":"min"==e?t="min":"max"==e?t="max":"exp"==e?t="exp":"ln"==e?t="ln":"log"==e?t="log":"avg"==e?t="avg":"count"==e?t="count":"stdev"==e||"stdev"==e?t="stDev":"concatenate"==e?t="concatenate":"len"==e&&(t="len"),t}},{key:"isNumber",value:function(e){var t=e;return"-"==e[0]&&(t=e.replace("-","")),/^[0-9.]*$/.test(t)}},{key:"concatenate",value:function(e){var t="";return e.forEach(function(e){null!=e&&(t+=e)}),t}},{key:"len",value:function(e){return null==e&&(e=""),u.isNumber(e)&&(e=e.toString()),e.length}},{key:"stDev",value:function(e){var t=e;if(!Array.isArray(e)){t=[];for(var n=0;n<arguments.length;n++){var o=arguments[n];null!=o&&t.push(parseFloat(o))}}var r=u.avg(t),l=t.map(function(e){var t=parseFloat(e)-r;return t*t}),i=u.avg(l);return Math.sqrt(i)}},{key:"count",value:function(e){var t=e;return Array.isArray(e)||(t=arguments),t.length}},{key:"sum",value:function(e){var t=e;Array.isArray(e)||(t=arguments);for(var n=0,o=0;o<t.length;o++){var r=t[o];null!=r&&(n+=parseFloat(r))}return n}},{key:"avg",value:function(e){var t=e;Array.isArray(e)||(t=arguments);for(var n=0,o=0;o<t.length;o++){var r=t[o];null!=r&&(n+=parseFloat(r))}return n/t.length}},{key:"sin",value:function(e){return Math.sin(parseFloat(e))}},{key:"cos",value:function(e){return Math.cos(parseFloat(e))}},{key:"atan",value:function(e){return Math.atan(parseFloat(e))}},{key:"round",value:function(e,t){return e=parseFloat(e),t=parseFloat(t),Number(Math.round(e+"e"+t)+"e-"+t)}},{key:"pow",value:function(e,t){return Math.pow(parseFloat(e),parseFloat(t))}},{key:"floor",value:function(e){return Math.floor(parseFloat(e))}},{key:"ceil",value:function(e){return Math.ceil(parseFloat(e))}},{key:"sqrt",value:function(e){return Math.sqrt(parseFloat(e))}},{key:"abs",value:function(e){return Math.abs(parseFloat(e))}},{key:"min",value:function(e){var t=e;return Array.isArray(e)||(t=arguments),Math.min.apply(Math,_toConsumableArray(t))}},{key:"max",value:function(e){return Math.max.apply(Math,_toConsumableArray(e))}},{key:"exp",value:function(e){return Math.exp(parseFloat(e))}},{key:"ln",value:function(e){return Math.log(parseFloat(e))}},{key:"log",value:function(e){return Math.log10(parseFloat(e))}},{key:"_CreateEntryInfoPanel",value:function(t,n,e,o,r){var l=document.createElement("div");l.setAttribute("class","cscfe_info_pnl_entry");var i=document.createElement("div");i.setAttribute("class","cscfe_info_pnl_entry_label"),i.textContent=e,l.appendChild(i);var a=document.createElement("div");return a.setAttribute("class","cscfe_info_pnl_entry_description"),a.innerHTML=r,l.appendChild(a),l.addEventListener("click",function(e){n.SetCommaMathFunction(o),t.style.display="none"}),l}},{key:"GetInfoPanel",value:function(e){var t=document.createElement("div");t.setAttribute("class","cscfe_info_pnl_container");var n=document.createElement("div");n.setAttribute("class","cscfe_info_pnl");var o=document.createElement("div");o.setAttribute("class","cscfe_info_pnl_header");var r=document.createElement("div");r.setAttribute("class","cscfe_info_pnl_header_title"),r.textContent="Available Functions",o.appendChild(r);var l=document.createElement("i");l.setAttribute("class","fa fa-times cscfe_info_pnl_closeBtn"),l.addEventListener("click",function(e){t.style.display="none"}),o.appendChild(l),n.appendChild(o);var i=document.createElement("div");i.style.display="flex";var a=document.createElement("div");a.appendChild(u._CreateEntryInfoPanel(t,e,"Sum","SUM()","Adds all the numbers in a range of cells.<br>Syntax: SUM(number1, number2,...) or SUM(D1:D5)")),a.appendChild(u._CreateEntryInfoPanel(t,e,"Round","ROUND()","Rounds a number to a specific number of digits.<br>Syntax: ROUND(number, numOfDigits) or ROUND(A1,B2)")),a.appendChild(u._CreateEntryInfoPanel(t,e,"Pow","POW()","Returns the result of a number (base) raised to a power (exponent).<br>Syntax: POW(base, exponent) or POW(A1,B2)")),a.appendChild(u._CreateEntryInfoPanel(t,e,"Sqrt","SQRT()","Returns the square root of a number.<br>Syntax: SQRT(number) or SQRT(A1)")),a.appendChild(u._CreateEntryInfoPanel(t,e,"Abs","ABS()","Returns the absolute value of a number.<br>Syntax: ABS(number) or ABS(A1)")),a.appendChild(u._CreateEntryInfoPanel(t,e,"Ceil","CEIL()","Rounds a number up to the next largest whole number or integer.<br>Syntax: CEIL(number) or CEIL(A1)")),a.appendChild(u._CreateEntryInfoPanel(t,e,"Floor","FLOOR()","Returns the largest integer less than or equal to a given number.<br>Syntax: FLOOR(number) or FLOOR(A1)")),i.appendChild(a);var s=document.createElement("div");s.appendChild(u._CreateEntryInfoPanel(t,e,"Min","MIN()","Returns the lowest-valued number passed into it.<br>Syntax: MIN(number1, number2,...) or MIN(D1:D5)")),s.appendChild(u._CreateEntryInfoPanel(t,e,"Max","MAX()","Returns the largest number passed into it.<br>Syntax: MAX(number1, number2,...) or MAX(D1:D5)")),s.appendChild(u._CreateEntryInfoPanel(t,e,"Exp","EXP()","Returns <code>e<sup>x</sup></code>, where x is the argument, and e is Euler's number.<br>Syntax: EXP(number1) or EXP(D1)")),s.appendChild(u._CreateEntryInfoPanel(t,e,"Ln","LN()","Returns the natural logarithm (base e) of a number.<br>Syntax: LN(number1) or LN(D1)")),s.appendChild(u._CreateEntryInfoPanel(t,e,"Log","LOG()","Returns the natural logarithm (base 10) of a number.<br>Syntax: LOG(number1) or LOG(D1)")),s.appendChild(u._CreateEntryInfoPanel(t,e,"Avg","AVG()","Returns the average (arythmetic mean) of its arguments.<br>Syntax: AVG(number1, number2,...) or AVG(D1:D5)")),s.appendChild(u._CreateEntryInfoPanel(t,e,"Standard Deviation","STDEV()","Returns the standard deviation of its arguments.<br>Syntax: STDEV(number1, number2,...) or STDEV(D1:D5)")),i.appendChild(s);var c=document.createElement("div");return c.appendChild(u._CreateEntryInfoPanel(t,e,"Count","COUNT(","Returns the number of its arguments.<br>Syntax: COUNT(number1, number2,...) or COUNT(D1:D5)")),c.appendChild(u._CreateEntryInfoPanel(t,e,"Sin","SIN()","Returns the sine of a number.<br>Syntax: SIN(number) or SIN(D1)")),c.appendChild(u._CreateEntryInfoPanel(t,e,"Cos","COS()","Returns the cosine of a number.<br>Syntax: COS(number) or COS(D1)")),c.appendChild(u._CreateEntryInfoPanel(t,e,"Atan","ATAN()","Returns the arctangent (in radians) of a number.<br>Syntax: ATAN(number) or ATAN(D1)")),c.appendChild(u._CreateEntryInfoPanel(t,e,"Concatenate","CONCATENATE()","Returns a string that concatenates all the strings passed as arguments.<br>Syntax: CONCATENATE(string1, string2, ....) or CONCATENATE(D1:D5)")),c.appendChild(u._CreateEntryInfoPanel(t,e,"Len","LEN()","Returns the number of characters in a string.<br>Syntax: LEN(string) or LEN(D1)")),i.appendChild(c),n.appendChild(i),t.appendChild(n),document.body.appendChild(t),t}}]),u}(),FunctionsManager=function(){function FunctionsManager(e){_classCallCheck(this,FunctionsManager),this.spreadsheet=e,this.input=void 0,this.currentTd=void 0,this.currentFunction=[],this.classesToHighlightCells=["cscfe_highlight_cell_one","cscfe_highlight_cell_two","cscfe_highlight_cell_three","cscfe_highlight_cell_four","cscfe_highlight_cell_five","cscfe_highlight_cell_six"],this.useHighlightClass=-1,this.precision=5,this.cellAffects={},this.labelInitialized=!1,this.inputInitialized=!1}return _createClass(FunctionsManager,[{key:"Reset",value:function(){this.cellAffects={},this.useHighlightClass=-1,this.precision=5,this.currentTd=void 0,this.currentFunction=[]}},{key:"SetPrecision",value:function(e){null==e&&(e=5),this.precision=parseInt(e)}},{key:"_round",value:function(e){return Number(Math.round(e+"e"+this.precision)+"e-"+this.precision)}},{key:"SetFxLabelNode",value:function(e){var t;this.labelInitialized||(this.labelInitialized=!0,this.fxLabel=e,null==(t=this).f_click&&(this.f_click=function(e){null==t.fxInfoPanel&&(t.fxInfoPanel=CommaMath.GetInfoPanel(t)),t.fxInfoPanel.style.display="flex"}),this.fxLabel.domElement.removeEventListener("click",this.f_click),this.fxLabel.domElement.addEventListener("click",this.f_click))}},{key:"SetInputNode",value:function(e){var t;this.inputInitialized||(this.inputInitialized=!0,this.input=e,null==(t=this).f_keyup&&(this.f_keyup=function(e){t.FunctionEdited(e)}),this.input.domElement.removeEventListener("keyup",this.f_keyup),this.input.domElement.addEventListener("keyup",this.f_keyup),null==this.f_mousedown&&(this.f_mousedown=function(e){t.spreadsheet.StartFunctionEditing()}),this.input.domElement.removeEventListener("mousedown",this.f_mousedown),this.input.domElement.addEventListener("mousedown",this.f_mousedown))}},{key:"GetCurrentCell",value:function(){return this.currentTd}},{key:"GetIdCurrentCell",value:function(){var e=void 0;return null!=this.currentTd&&(e=this.currentTd.id),e}},{key:"SetEditingCell",value:function(e){this.HideInputError(),this.currentTd=e,this.currentFunction=JSON.parse(e.domElement.getAttribute("cell-function")),this.originalFunction=this.currentFunction,this.input.domElement.value=this.FunctionJsonToString(),this.currentCellCoordinates=this.spreadsheet.GetCoordinatesPerNode(this.currentTd.id),this.HighlightAllRanges()}},{key:"StartEditingCell",value:function(e){this.HideInputError(),""==this.input.domElement.value?(this.input.domElement.value="=",this.currentFunction=this.StringToFunctionJson(this.input.domElement.value)):this.currentFunction=JSON.parse(e.domElement.getAttribute("cell-function")),this.input.domElement.focus(),this.currentTd=e,this.originalFunction=this.currentFunction,this.currentCellCoordinates=this.spreadsheet.GetCoordinatesPerNode(this.currentTd.id),this.HighlightAllRanges()}},{key:"StopEditingCell",value:function(){null!=this.input&&(this.input.domElement.value=""),this.currentTd=void 0}},{key:"FunctionEdited",value:function(e){var t=e.key;"Esc"==t||"Escape"==t?(this.input.domElement.value="",this.spreadsheet.StopFunctionEditing(!0)):"Enter"==t?(this.currentTd.domElement.setAttribute("cell-function",JSON.stringify(this.currentFunction)),this.TrackCell(this.currentTd,this.currentCellCoordinates.row,this.currentCellCoordinates.col),this.spreadsheet.StopFunctionEditing(!0)):(this.DehighlightAllRanges(),this.currentFunction=this.StringToFunctionJson(this.input.domElement.value,this.currentCellCoordinates),this.HighlightAllRanges(),this.EvalFunctionPerNode(this.currentTd,this.currentCellCoordinates,this.currentFunction))}},{key:"EvalFunctionPerNode",value:function EvalFunctionPerNode(tdCell,currentCellCoordinates,currentFunction){var skipPushToHistory=3<arguments.length&&void 0!==arguments[3]&&arguments[3];if(this.noCircularReference(currentCellCoordinates))this.showCircularError||(this.ShowInputError(),this.showCircularError=!0,alert("Formula cannot be calculated: cell references in the formula refer to the formula's result, creating a circular reference."));else{this.showCircularError=!1;var tn=tdCell.GetFirstTextNode(),nv=void 0;try{nv=eval(this.GetStringForEval(tdCell,currentCellCoordinates,currentFunction)),this.HideInputError()}catch(e){this.ShowInputError()}null==nv&&(nv=""),tn.ForceTextContent(nv.toString()),_CellFormatter__WEBPACK_IMPORTED_MODULE_0__.a.Format(tdCell),this.CellValueChanged(tdCell,skipPushToHistory)}}},{key:"HideInputError",value:function(){this.input.domElement.classList.remove("functionWithErrors")}},{key:"ShowInputError",value:function(){this.input.domElement.classList.add("functionWithErrors")}},{key:"_insertBeforeCursor",value:function(e,t){e.setRangeText?e.setRangeText(t):(e.focus(),document.execCommand("insertText",!1,t))}},{key:"_insertAtCursor",value:function(e,t){var n,o;document.selection?(e.focus(),sel=document.selection.createRange(),sel.text=t):e.selectionStart||"0"==e.selectionStart?(n=e.selectionStart,o=e.selectionEnd,e.value=e.value.substring(0,n)+t+e.value.substring(o,e.value.length)):e.value+=t}},{key:"_moveCursorBackOne",value:function(){var e,t,n=this.input.domElement;null!=n&&((e=n.selectionStart-1)<0&&(e=0),n.setSelectionRange?(n.focus(),n.setSelectionRange(e,e)):n.createTextRange&&((t=n.createTextRange()).collapse(!0),t.moveEnd("character",e),t.moveStart("character",e),t.select()))}},{key:"SetCommaMathFunction",value:function(e){null==this.currentTd&&1==this.spreadsheet.selectedNodes.length&&this.spreadsheet.StartFunctionEditing(this.spreadsheet.selectedNodes[0]),this._insertAtCursor(this.input.domElement,e),this._moveCursorBackOne(),this.currentFunction=this.StringToFunctionJson(this.input.domElement.value,this.currentCellCoordinates)}},{key:"noCircularReference",value:function(e,t){var n,o,r=1<arguments.length&&void 0!==t?t:void 0,l=!1;return null==r&&(r=e.row+"#"+e.col),null!=this.cellAffects&&null!=this.cellAffects[e.row]&&null!=this.cellAffects[e.row][e.col]&&(-1<(n=this.cellAffects[e.row][e.col]).indexOf(r)?l=!0:(o=this,n.forEach(function(e){var t,n;l||(n={row:(t=e.split("#"))[0],col:t[1]},l=o.noCircularReference(n,r))}))),l}},{key:"GetRangeValue",value:function(e,t){var n,o,r=e.r1c1,l=0,i=0,l=r.isColAbsolute?r.col:t.col+parseInt(r.col),i=r.isRowAbsolute?parseInt(r.row)-1:t.row+parseInt(r.row)-1;return"range"==r.type?(n=o=0,n=r.toCell.isColAbsolute?parseInt(r.toCell.col):t.col+parseInt(r.toCell.col),o=r.toCell.isRowAbsolute?parseInt(r.toCell.row)-1:t.row+parseInt(r.toCell.row)-1,this.spreadsheet.GetValues(i,l,o,n)):this.spreadsheet.GetValue(i,l)}},{key:"_prepareValue",value:function(e,t){return e&&"string"==typeof t&&(""==(t=t.replace(/^[\s\uFEFF\xA0]+|[\s\uFEFF\xA0]+$/g,""))?t=0:t.match(/[a-zA-Z]/i)&&(t='"'+t+'"')),t}},{key:"GetStringForEval",value:function(e,o,t){var r=this,l="";null==t&&(t=[]);var i=!0,a=!1,s="";return t.forEach(function(e){var t,n;"space"!=e.type&&("function"==e.type?(s=e.value.toLowerCase(),"string"==CommaMath.getFunctionType(e.value.toLowerCase())&&(a=!(i=!1))):"range"==e.type?i&&""==s&&(t=r.GetRangeValue(e,o),Array.isArray(t)?t.forEach(function(e){"string"==typeof r._prepareValue(i,e)&&(i=!1)}):"string"==typeof r._prepareValue(i,t)&&(i=!1)):"value"==e.type?""!=e.value&&(n=parseFloat(e.value),CommaMath.isNumber(n)||(i=!1)):"operator"==e.type&&")"==e.value&&(s=""))}),t.forEach(function(e){var t,n;"space"!=e.type&&("function"==e.type?l=l+"CommaMath."+CommaMath.getFunctionName(e.value):"range"==e.type?(t=r.GetRangeValue(e,o),Array.isArray(t)?(n=[],t.forEach(function(e){n.push(r._prepareValue(i,e))}),l+=JSON.stringify(n)):l+=r._prepareValue(i,t)):"value"==e.type?l+=r._prepareValue(i,e.value):l+=e.value)}),i&&""!=l?l="this._round("+l+")":a||(l="'"+l+"'"),l}},{key:"FunctionJsonToString",value:function(){var t="";return null!=this.currentFunction&&this.currentFunction.forEach(function(e){t+=e.value}),t}},{key:"GetFunctionFromDomNode",value:function(e){return e.getAttribute("cell-function")}},{key:"CopyFunctionToNode",value:function(e,t){var a,s,c,n;null!=e&&""!=e&&(a=this.spreadsheet.GetCoordinatesPerNode(t.id),s=this.spreadsheet.GetNumberOfColumns(),c=this.spreadsheet.GetNumberOfRows(),(n=JSON.parse(e)).forEach(function(e){var t,n,o,r,l,i;"range"==e.type&&(i="",i=(t=e.r1c1).isColAbsolute?"$"+FunctionsManager.toColumnName(t.col):(n=a.col+parseInt(t.col),s<n&&(t.col=s-a.col,n=a.col+parseInt(t.col)),FunctionsManager.toColumnName(n)),t.isRowAbsolute?i+="$"+t.row:(o=a.row+parseInt(t.row),c<o&&(t.row=c-a.row,o=a.row+parseInt(t.row)),i+=o),"range"==t.type&&(t.toCell.isColAbsolute?i+=":$"+FunctionsManager.toColumnName(t.toCell.col):(r=a.col+parseInt(t.toCell.col),s<r&&(t.toCell.col=s-a.col,r=a.col+parseInt(t.toCell.col)),i+=":"+FunctionsManager.toColumnName(r)),t.toCell.isRowAbsolute?i+="$"+t.toCell.row:(l=a.row+parseInt(t.toCell.row),c<l&&(t.toCell.row=c-a.row,l=a.row+parseInt(t.toCell.row)),i+=l)),e.value=i)}),t.domElement.setAttribute("cell-function",JSON.stringify(n)),this.TrackCell(t,a.row,a.col),this.EvalFunctionPerNode(t,a,n))}},{key:"StringToFunctionJson",value:function(e,t){for(var n=[],o="",r="",l=!1,i=0;i<e.length;i++){var a=e[i],s=parseInt(a);" "!=a&&"="!=a?CommaMath.isNumber(s)?l?r+=a:o+=a:"+"==a||"-"==a||"*"==a||"/"==a||"("==a||")"==a||"%"==a||","==a||"."==a?(""!=o?(n.push({type:"value",value:o}),o=""):""!=r&&(CommaMath.isFunction(r.toLowerCase())?n.push({type:"function",value:r}):n.push({type:"range",value:r}),r=""),n.push({type:"operator",value:a}),l=!1):"$"==a||":"==a?(r+=a,l=!0):a.match(/[a-zA-Z]/i)&&(r+=a.toUpperCase(),l=!0):n.push({type:"space",value:a})}""!=o?n.push({type:"value",value:o}):""!=r&&n.push({type:"range",value:r});var c=this;return n.forEach(function(e){"range"==e.type&&(e.r1c1=c.stringToR1C1(e.value,t))}),n}},{key:"stringToR1C1",value:function(e,t){for(var n,o,r,l=void 0,i=!1,a="",s="",c=!1,u=!1,d=0;d<e.length;d++){var h,f=e[d],p=parseInt(f);CommaMath.isNumber(p)?(s+=f,i=i&&!(u=!0)):":"==f?(h=0,h=c?this.colNameToNumber(a):this.colNameToNumber(a)-t.col,l={type:"single",isColAbsolute:c,isRowAbsolute:u,row:u?parseInt(s):parseInt(s)-t.row,col:h},s=a="",u=c=i=!1):"$"==f?i=!0:f.match(/[a-zA-Z]/i)&&(a+=f,i=i&&!(c=!0))}return null!=l?(o=n=0,n=c?this.colNameToNumber(a):this.colNameToNumber(a)-t.col,o=u?parseInt(s):parseInt(s)-t.row,l.type="range",l.toCell={isColAbsolute:c,isRowAbsolute:u,row:o,col:n}):(r=0,r=c?this.colNameToNumber(a):this.colNameToNumber(a)-t.col,l={type:"single",isColAbsolute:c,isRowAbsolute:u,row:u?parseInt(s):parseInt(s)-t.row,col:r}),l}},{key:"GetNextHighlightColor",value:function(){return this.useHighlightClass++,this.useHighlightClass>this.classesToHighlightCells.length-1&&(this.useHighlightClass=0),this.classesToHighlightCells[this.useHighlightClass]}},{key:"StartSelectingCells",value:function(){return this.currentRange={},this.GetNextHighlightColor()}},{key:"DehighlightAllRanges",value:function(){var t;null!=this.currentFunction&&(t=this).currentFunction.forEach(function(e){"range"==e.type&&t.ToggleRange(!1,e,t.currentCellCoordinates)})}},{key:"HighlightAllRanges",value:function(){var t;this.useHighlightClass=0,null!=this.currentFunction&&(t=this).currentFunction.forEach(function(e){"range"==e.type&&t.ToggleRange(!0,e,t.currentCellCoordinates)})}},{key:"ToggleRange",value:function(e,t,n,o){var r,l=t.r1c1,i=0,a=0,s=void 0,c=void 0,u=!1;null!=o&&(u=!0,a=(r=o.r1c1).isColAbsolute?r.col:n.col+parseInt(r.col),i=r.isRowAbsolute?parseInt(r.row)-1:n.row+parseInt(r.row)-1,"range"==r.type&&(c=r.toCell.isColAbsolute?parseInt(r.toCell.col):n.col+parseInt(r.toCell.col),s=r.toCell.isRowAbsolute?parseInt(r.toCell.row)-1:n.row+parseInt(r.toCell.row)-1));var d,h,f=0,p=0,f=l.isColAbsolute?l.col:n.col+parseInt(l.col),p=l.isRowAbsolute?parseInt(l.row)-1:n.row+parseInt(l.row)-1;"range"==l.type?(d=h=0,d=l.toCell.isColAbsolute?parseInt(l.toCell.col):n.col+parseInt(l.toCell.col),h=l.toCell.isRowAbsolute?parseInt(l.toCell.row)-1:n.row+parseInt(l.toCell.row)-1,CommaMath.isNumber(p)&&CommaMath.isNumber(h)&&(e?this.spreadsheet.SelectRangeForFunctionEditing(p,f,h,d,this.GetNextHighlightColor()):this.spreadsheet.DeselectRangeForFunctionEditing(p,f,h,d,u,i,a,s,c))):CommaMath.isNumber(p)&&(e?this.spreadsheet.SelectRangeForFunctionEditing(p,f,void 0,void 0,this.GetNextHighlightColor()):this.spreadsheet.DeselectRangeForFunctionEditing(p,f,void 0,void 0,u,i,a,s,c))}},{key:"ClearCurrentRange",value:function(){this.currentRange={}}},{key:"AddCell",value:function(e,t){null==this.currentRange[e]&&(this.currentRange[e]=new Array),this.currentRange[e][t]=!0}},{key:"colNameToNumber",value:function(e){for(var t="ABCDEFGHIJKLMNOPQRSTUVWXYZ",n=0,o=0,r=e.length-1;o<e.length;o+=1,--r)n+=Math.pow(t.length,r)*(t.indexOf(e[o])+1);return n}},{key:"addRangeToCurrentFunction",value:function(e){var t={type:"range",value:e,r1c1:this.stringToR1C1(e,this.currentCellCoordinates)};null==this.currentFunction&&(this.currentFunction=[]);var n,o=this.currentFunction[this.currentFunction.length-1];null!=o&&"range"==o.type&&(n=this.currentFunction.pop(),this.ToggleRange(!1,n,this.currentCellCoordinates,t)),this.currentFunction.push(t)}},{key:"DoneSelectingCells",value:function(){var e="",t=!0,n="";for(var o in this.currentRange)if(this.currentRange.hasOwnProperty(o))for(var r in this.currentRange[o])this.currentRange[o].hasOwnProperty(r)&&(t?(t=!1,e=FunctionsManager.toColumnName(r)+(parseInt(o)+1)):n=FunctionsManager.toColumnName(r)+(parseInt(o)+1));""!=n&&(n=":"+n);var l,i,a=this.currentFunction[this.currentFunction.length-1];null!=a&&"range"==a.type&&(l=this.currentFunction.pop(),i=this.input.domElement.value.lastIndexOf(l.value),this.input.domElement.value=this.input.domElement.value.substring(0,i),this.ToggleRange(!1,l,this.currentCellCoordinates)),this._insertAtCursor(this.input.domElement,e+n),this.DehighlightAllRanges(),this.currentFunction=this.StringToFunctionJson(this.input.domElement.value,this.currentCellCoordinates),this.HighlightAllRanges(),this.EvalFunctionPerNode(this.currentTd,this.currentCellCoordinates,this.currentFunction)}},{key:"RecalculateAll",value:function(){var o=this;this.spreadsheet.tableNode.children.forEach(function(e){"tbody"==e.tagName.toLowerCase()&&e.children.forEach(function(e){e.children.forEach(function(e){var t=o.spreadsheet.GetCoordinatesPerNode(e.id),n=JSON.parse(e.domElement.getAttribute("cell-function"));null!=n&&o.EvalFunctionPerNode(e,t,n,!0)})})})}},{key:"CellValueChanged",value:function(e,t){var n=this.spreadsheet.GetCoordinatesPerNode(e.id),o=n.row,r=n.col,l=this.GetAffectedCells(o,r),i=this;l.forEach(function(e){e.row=parseInt(e.row),e.col=parseInt(e.col);var t=i.spreadsheet.GetNodePerCoordinates(e.row,e.col),n=JSON.parse(t.domElement.getAttribute("cell-function"));null!=n&&i.EvalFunctionPerNode(t,e,n)})}},{key:"GetAffectedCells",value:function(e,t){var n=[];return null!=this.cellAffects&&null!=this.cellAffects[e]&&null!=this.cellAffects[e][t]&&this.cellAffects[e][t].forEach(function(e){var t=e.split("#");n.push({row:t[0],col:t[1]})}),n}},{key:"TrackCell",value:function(e,s,c){var t,u;null!=e.domElement.getAttribute("cell-function")&&(t=JSON.parse(e.domElement.getAttribute("cell-function")),null==(u=this).cellAffects&&(u.cellAffects={}),Object.keys(u.cellAffects).forEach(function(n){var e=u.cellAffects[n];Object.keys(e).forEach(function(e){var t;-1<u.cellAffects[n][e].indexOf(s+"#"+c)&&(t=[],u.cellAffects[n][e].forEach(function(e){e!=s+"#"+c&&t.push(e)}),u.cellAffects[n][e]=t)})}),t.forEach(function(e){if("range"==e.type){var t=e.r1c1,n=0,o=0,n=t.isColAbsolute?t.col:c+parseInt(t.col),o=t.isRowAbsolute?parseInt(t.row)-1:s+parseInt(t.row)-1,r=0,l=0;if("range"==t.type){l=t.toCell.isColAbsolute?parseInt(t.toCell.col):c+parseInt(t.toCell.col),r=t.toCell.isRowAbsolute?parseInt(t.toCell.row)-1:s+parseInt(t.toCell.row)-1;for(var i=o;i<=r;){for(var a=n;a<=l;)null==u.cellAffects[i]&&(u.cellAffects[i]={},u.cellAffects[i][a]=[]),null==u.cellAffects[i][a]&&(u.cellAffects[i][a]=[]),u.cellAffects[i][a].indexOf(s+"#"+c)<0&&u.cellAffects[i][a].push(s+"#"+c),a++;i++}}else null==u.cellAffects[o]&&(u.cellAffects[o]={},u.cellAffects[o][n]=[]),null==u.cellAffects[o][n]&&(u.cellAffects[o][n]=[]),u.cellAffects[o][n].indexOf(s+"#"+c)<0&&u.cellAffects[o][n].push(s+"#"+c)}}))}}],[{key:"toColumnName",value:function(e){for(var t="",n=1,o=26;0<=(e-=n);n=o,o*=26)t=String.fromCharCode(parseInt(e%o/n)+65)+t;return t}},{key:"RemoveFunction",value:function(e){e.domElement.removeAttribute("cell-function")}},{key:"AdjustAllRowsOnInsert",value:function(e,t,a){var s,c,n=JSON.parse(e.domElement.getAttribute("cell-function"));null!=n&&(s=t.GetCoordinatesPerNode(e.id),c=s.row,s.row>=a&&(c=s.row+1),n.forEach(function(e){var t,n,o,r,l,i;"range"==e.type&&((t=e.r1c1).row=parseInt(t.row),t.col=parseInt(t.col),o="",o=t.isColAbsolute?"$"+FunctionsManager.toColumnName(t.col):(n=s.col+t.col,FunctionsManager.toColumnName(n)),t.isRowAbsolute?o+="$"+t.row:(r=s.row+t.row-1,s.row>=a&&r<a?t.row=t.row-1:s.row<a&&a<=r&&(t.row=t.row+1),o+=c+t.row),"range"==t.type&&(t.toCell.isColAbsolute?o+=":$"+FunctionsManager.toColumnName(t.toCell.col):(l=s.col+parseInt(t.toCell.col),o+=":"+FunctionsManager.toColumnName(l)),t.toCell.isRowAbsolute?o+="$"+t.toCell.row:(i=s.row+t.toCell.row-1,s.row>=a&&i<a?t.toCell.row=t.toCell.row-1:s.row<a&&a<=i&&(t.toCell.row=t.toCell.row+1),o+=c+t.toCell.row)),e.value=o)}),e.domElement.setAttribute("cell-function",JSON.stringify(n)))}},{key:"AdjustAllRowsOnDelete",value:function(e,t,n){var c,o=JSON.parse(e.domElement.getAttribute("cell-function"));null!=o&&(c=t.GetCoordinatesPerNode(e.id),n.forEach(function(a){var s;a!=c.row&&(s=c.row,c.row>a&&(s=c.row-1),o.forEach(function(e){var t,n,o,r,l,i;"range"==e.type&&((t=e.r1c1).row=parseInt(t.row),t.col=parseInt(t.col),o="",o=t.isColAbsolute?"$"+FunctionsManager.toColumnName(t.col):(n=c.col+t.col,FunctionsManager.toColumnName(n)),t.isRowAbsolute?o+="$"+t.row:(r=c.row+t.row-1,c.row>=a&&r<a?t.row=t.row+1:c.row<a&&a<=r&&(t.row=t.row-1),o+=s+t.row),"range"==t.type&&(t.toCell.isColAbsolute?o+=":$"+FunctionsManager.toColumnName(t.toCell.col):(l=c.col+parseInt(t.toCell.col),o+=":"+FunctionsManager.toColumnName(l)),t.toCell.isRowAbsolute?o+="$"+t.toCell.row:(i=c.row+t.toCell.row-1,c.row>=a&&i<a?t.toCell.row=t.toCell.row+1:c.row<a&&a<=i&&(t.toCell.row=t.toCell.row-1),o+=s+t.toCell.row)),e.value=o)}),c.row=s)}),e.domElement.setAttribute("cell-function",JSON.stringify(o)))}},{key:"AdjustAllColsOnInsert",value:function(e,t,l){var i,a,n=JSON.parse(e.domElement.getAttribute("cell-function"));null!=n&&(i=t.GetCoordinatesPerNode(e.id),a=i.col,i.col>=l&&(a=i.col+1),n.forEach(function(e){var t,n,o,r;"range"==e.type&&((t=e.r1c1).row=parseInt(t.row),t.col=parseInt(t.col),n="",t.isColAbsolute?n="$"+FunctionsManager.toColumnName(t.col):(o=i.col+t.col,i.col>=l&&o<l?t.col=t.col-1:i.col<l&&l<=o&&(t.col=t.col+1),n+=FunctionsManager.toColumnName(a+t.col)),t.isRowAbsolute?n+="$"+t.row:n+=i.row+parseInt(t.row),"range"==t.type&&(t.toCell.isColAbsolute?n+=":$"+FunctionsManager.toColumnName(t.toCell.col):(r=i.col+t.toCell.col,i.col>=l&&r<l?t.toCell.col=t.toCell.col-1:i.col<l&&l<=r&&(t.toCell.col=t.toCell.col+1),n+=":"+FunctionsManager.toColumnName(a+t.toCell.col)),t.toCell.isRowAbsolute?n+="$"+t.toCell.row:n+=i.row+parseInt(t.toCell.row)),e.value=n)}),e.domElement.setAttribute("cell-function",JSON.stringify(n)))}},{key:"AdjustAllColsOnDelete",value:function(e,t,n){var a,o=JSON.parse(e.domElement.getAttribute("cell-function"));null!=o&&(a=t.GetCoordinatesPerNode(e.id),n.forEach(function(l){var i;l!=a.col&&(i=a.col,a.col>l&&(i=a.col-1),o.forEach(function(e){var t,n,o,r;"range"==e.type&&((t=e.r1c1).row=parseInt(t.row),t.col=parseInt(t.col),n="",t.isColAbsolute?n="$"+FunctionsManager.toColumnName(t.col):(o=a.col+t.col,a.col>=l&&o<l?t.col=t.col+1:a.col<l&&l<=o&&(t.col=t.col-1),n+=FunctionsManager.toColumnName(i+t.col)),t.isRowAbsolute?n+="$"+t.row:n+=a.row+t.row,"range"==t.type&&(t.toCell.isColAbsolute?n+=":$"+FunctionsManager.toColumnName(t.toCell.col):(r=a.col+t.toCell.col,a.col>=l&&r<l?t.toCell.col=t.toCell.col+1:a.col<l&&l<=r&&(t.toCell.col=t.toCell.col-1),n+=":"+FunctionsManager.toColumnName(i+t.toCell.col)),t.toCell.isRowAbsolute?n+="$"+t.toCell.row:n+=a.row+parseInt(t.toCell.row)),e.value=n)}),a.col=i)}),e.domElement.setAttribute("cell-function",JSON.stringify(o)))}}]),FunctionsManager}()},function(e,t,n){"use strict";n.r(t);var C=n(0);function s(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function o(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}function l(e,t,n){return t&&o(e.prototype,t),n&&o(e,n),e}var r=function(){function r(e,t,n){s(this,r),this.onChangeCallback=n;var o=document.createElement("div");o.style.position="absolute",o.style.zIndex="99999",o.style.border="1px solid #e1e1e1",o.style.borderRadius="2px",o.style.backgroundColor="#f9f9f9",o.style.padding="4px",o.style.left=e,o.style.top=t,o.style.outline="none",o.setAttribute("tabindex","3333"),o.addEventListener("blur",function(){this.parentNode.removeChild(this)}),this.canvas=document.createElement("canvas"),this.width=200,this.height=140,this.canvas.width=this.width,this.canvas.height=this.height,this.canvas.style.cursor="pointer",this.context=this.canvas.getContext("2d"),this.pickerCircle={x:10,y:10,width:7,height:7},this.draw(),o.appendChild(this.canvas),this.previewbox=document.createElement("div"),this.previewbox.style.width="200px",this.previewbox.style.height="14px",this.previewbox.style.backgroundColor="rgba(0,0,0,0)",o.appendChild(this.previewbox),this.listenForEvents(),document.body.appendChild(o),o.focus(),this.panel=o}return l(r,[{key:"draw",value:function(){this.build()}},{key:"build",value:function(){var e=this.context.createLinearGradient(0,0,this.width,0);e.addColorStop(0,"rgb(255, 0, 0)"),e.addColorStop(.15,"rgb(255, 0, 255)"),e.addColorStop(.33,"rgb(0, 0, 255)"),e.addColorStop(.49,"rgb(0, 255, 255)"),e.addColorStop(.67,"rgb(0, 255, 0)"),e.addColorStop(.84,"rgb(255, 255, 0)"),e.addColorStop(1,"rgb(255, 0, 0)"),this.context.fillStyle=e,this.context.fillRect(0,0,this.width,this.height),(e=this.context.createLinearGradient(0,0,0,this.height)).addColorStop(0,"rgba(255, 255, 255, 1)"),e.addColorStop(.5,"rgba(255, 255, 255, 0)"),e.addColorStop(.5,"rgba(0, 0, 0, 0)"),e.addColorStop(1,"rgba(0, 0, 0, 1)"),this.context.fillStyle=e,this.context.fillRect(0,0,this.width,this.height),this.context.beginPath(),this.context.arc(this.pickerCircle.x,this.pickerCircle.y,this.pickerCircle.width,0,2*Math.PI),this.context.strokeStyle="#ffffff",this.context.stroke(),this.context.closePath()}},{key:"listenForEvents",value:function(){var r=this;this.canvas.addEventListener("mousemove",function(e){var t=r.canvas.getBoundingClientRect(),n=e.clientX-t.left,o=e.clientY-t.top;r.pickerCircle.x=n,r.pickerCircle.y=o,r.previewbox.style.backgroundColor=r.getPickedColor(),r.draw()}),this.canvas.addEventListener("click",function(){return r.SelectColor()})}},{key:"getPickedColor",value:function(){var e=this.context.getImageData(this.pickerCircle.x,this.pickerCircle.y,1,1);return"#"+this.fullColorHex(e.data[0],e.data[1],e.data[2])}},{key:"SelectColor",value:function(){try{this.panel.parentNode.removeChild(this.panel)}catch(e){}this.onChangeCallback(this.getPickedColor())}},{key:"rgbToHex",value:function(e){var t=Number(e).toString(16);return t.length<2&&(t="0"+t),t}},{key:"fullColorHex",value:function(e,t,n){return this.rgbToHex(e)+this.rgbToHex(t)+this.rgbToHex(n)}}]),r}(),i=function(){function a(e,t){var n=2<arguments.length&&void 0!==arguments[2]?arguments[2]:0,o=3<arguments.length&&void 0!==arguments[3]?arguments[3]:0,r=4<arguments.length&&void 0!==arguments[4]?arguments[4]:void 0,l=5<arguments.length&&void 0!==arguments[5]&&arguments[5],i=6<arguments.length&&void 0!==arguments[6]&&arguments[6];s(this,a),this.event=e,this.callBack=t,this.preserveFocus=i,this.keepOnAfterSelection=l,this.addToLeft=n,this.addToTop=o,this.selectedColor=this._parseSelectedColor(r),this.usedCustomColors=[],"undefined"!=typeof Storage&&(this.usedCustomColors=JSON.parse(localStorage.getItem("usedCustomColors")),null==this.usedCustomColors&&(this.usedCustomColors=[])),this._showColorPalette()}return l(a,[{key:"_parseSelectedColor",value:function(e){var t,n=e;return null!=e&&-1<e.toLowerCase().indexOf("rgb")&&(t=(e=e.toLowerCase()).split("(")[1].split(")")[0].split(","),n="#"+this._rgbToHex(t[0].split(" ").join(""))+this._rgbToHex(t[1].split(" ").join(""))+this._rgbToHex(t[2].split(" ").join(""))),n}},{key:"_rgbToHex",value:function(e){var t=Number(e).toString(16);return t.length<2&&(t="0"+t),t}},{key:"_showColorPalette",value:function(){var n=this,o=document.createElement("div");o.style.position="absolute",o.style.zIndex="99999",o.style.border="1px solid #e1e1e1",o.style.borderRadius="2px",o.style.backgroundColor="#f9f9f9",o.style.padding="4px 4px 0px 0px",o.style.outline="none",o.setAttribute("tabindex","123");var e=this.event.srcElement.getBoundingClientRect();o.style.left=e.left+parseInt(this.addToLeft)+"px",o.style.top=parseInt(this.addToTop)+window.scrollY+e.height+e.top+"px";var t=[];t.push(["#dfb9b1","#eecdcd","#f8e5d0","#fdf2d0","#dce9d5","#d3dfe2","#ccdaf5","#d2e1f1","#d8d2e7","#e6d2db"]),t.push(["#d08270","#de9c9b","#f2cca2","#fbe5a3","#bcd5ac","#a9c3c8","#a9c2f0","#a6c4e5","#b2a8d2","#cea8bc"]),t.push(["#bd4b31","#d16d6a","#ecb476","#ffefa1","#9dc284","#80a4ad","#779ee5","#7ba7d7","#8b7ebe","#b87f9e"]),t.push(["#982a15","#bb261a","#da944b","#eac251","#78a55a","#53808c","#4a79d1","#4f85c1","#6351a2","#9b5378"]),t.push(["#7a2817","#8c1a11","#a96324","#b89130","#48742c","#264e5b","#2657c5","#24538f","#312071","#6b2346"]);var r=document.createElement("div");r.style.display="flex",r.style.marginTop="2px",r.style.marginBottom="6px",["#000000","#39434d","#666666","#999999","#b7b7b7","#cccccc","#d9d9d9","#efefef","#ffffff","TRANSPARENT"].forEach(function(e){var t=n._getDomCell_colorPicker(e,o);r.appendChild(t)}),o.appendChild(r),t.forEach(function(e){(r=document.createElement("div")).style.display="flex",e.forEach(function(e){var t=n._getDomCell_colorPicker(e,o);r.appendChild(t)}),o.appendChild(r)});var l,i=document.createElement("div");i.style.display="flex",i.style.justifyContent="center",i.style.alignItems="center",i.style.cursor="pointer",i.style.fontFamily="Arial",i.style.padding="2px 4px 2px 4px",i.style.fontSize="14px",i.style.color="#999999",i.textContent="Custom",i.addEventListener("mouseover",function(){this.style.color="#30b7e8"}),i.addEventListener("mouseout",function(){this.style.color="#999999"}),i.addEventListener("click",function(){n.pnl.style.display="none",n.ShowCustomPanel()}),o.appendChild(i),0<this.usedCustomColors.length?((l=document.createElement("div")).style.display="flex",l.style.marginTop="2px",l.style.marginBottom="0px",this.usedCustomColors.forEach(function(e){var t=n._getDomCell_colorPicker(e,o);l.appendChild(t)}),o.appendChild(l)):i.style.padding="2px 4px 4px 4px",o.addEventListener("blur",function(){n.keepOnAfterSelection||this.parentNode.removeChild(this)}),document.body.appendChild(o),o.focus(),this.pnl=o}},{key:"_getDomCell_colorPicker",value:function(e){var t,n=this,o=e,r=this.selectedColor,l=void 0;return"TRANSPARENT"==e?((l=document.createElement("canvas")).width=13,l.height=13,l.style.border="2px solid #ffffff",l.style.margin="0px 0px 4px 4px ",l.style.borderRadius="2px",(t=l.getContext("2d")).fillStyle="#ffffff",t.fillRect(0,0,l.width,l.height),t.strokeStyle="#FF0000",t.lineWidth=2,t.beginPath(),t.moveTo(0,13),t.lineTo(13,0),t.stroke()):((l=document.createElement("div")).style.width="13px",l.style.height="13px",l.style.backgroundColor=o,l.style.margin="0px 0px 4px 4px ",l.style.borderRadius="2px",l.style.border=r==o?"2px solid #30b7e8":"2px solid "+o),l.addEventListener("mouseover",function(){this.style.cursor="pointer",this.style.border="2px solid #30b7e8"}),l.addEventListener("mouseout",function(){this.style.border=o!=r?"TRANSPARENT"==o?"2px solid #ffffff":"2px solid "+o:"2px solid #30b7e8"}),l.addEventListener("click",function(){if(n.callBack(o),!n.keepOnAfterSelection)try{n.pnl.parentNode.removeChild(n.pnl)}catch(e){}}),this.preserveFocus&&l.addEventListener("mousedown",function(e){e.preventDefault()}),l}},{key:"ShowCustomPanel",value:function(){var t=this;new r(this.pnl.style.left,this.pnl.style.top,function(e){t.usedCustomColors.indexOf(e)<0&&(t.usedCustomColors.push(e),10<t.usedCustomColors.length&&t.usedCustomColors.shift(),localStorage.setItem("usedCustomColors",JSON.stringify(t.usedCustomColors))),t.callBack(e),null===t.pnl.parentNode||t.pnl.parentNode.removeChild(t.pnl)})}}]),a}(),c=n(2),p=n(1);function a(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}var u=function(){function o(e,t,n){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,o),this.spreadsheet=e,this.td=t,this.event=n,this.Init()}var e,t,n;return e=o,(t=[{key:"_addMenuEntry",value:function(e,t,n){var o=this,r=document.createElement("div");return r.style.padding="6px 10px 6px 10px",r.style.fontFamily="Arial",r.style.fontSize="12px",r.style.margin="0px",r.style.cursor="pointer",r.style.backgroundColor="#ffffff",r.style.color="#828282",r.innerText=n,r.addEventListener("mouseover",function(e){this.style.backgroundColor="#FF9100",this.style.color="#ffffff"}),r.addEventListener("mouseout",function(e){this.style.backgroundColor="#ffffff",this.style.color="#828282"}),r.addEventListener("click",function(e){o.PerformAction(t)}),e.appendChild(r),e}},{key:"_addMenuSpace",value:function(e){var t=document.createElement("div");return t.style.height="1px",t.style.backgroundColor="#e3e3e3",e.appendChild(t),e}},{key:"Init",value:function(){var e=this,t=document.createElement("div");t.style.backgroundColor="#ffffff",t.style.width="180px",t.style.height="291px",t.style.borderRadius="2px",t.style.boxShadow="2px 2px 5px #e3e3e3",t.style.position="fixed";var n=this.event.clientX+4,o=this.event.clientY-60;o<0&&(o=1),o+291>window.innerHeight&&(o=window.innerHeight-295),t.style.left=n+"px",t.style.top=o+"px",t.style.overflow="auto",t.style.zIndex="999";var r=document.createElement("input");r.style.opacity=0,r.style.position="absolute",r.style.width="0px",r.style.height="0px",this.keepAlive=!1,r.addEventListener("blur",function(){setTimeout(function(){e.keepAlive||e.destroy()},200)}),t.appendChild(r);var l="";1<this.spreadsheet.selectedNodes.length&&(l="s"),t=this._addMenuEntry(t,"addRowAbove","Insert Row Above"),t=this._addMenuEntry(t,"addRowBelow","Insert Row Below"),t=this._addMenuSpace(t),t=this._addMenuEntry(t,"addColLeft","Insert Column Before"),t=this._addMenuEntry(t,"addColRight","Insert Column After"),t=this._addMenuSpace(t),t=this._addMenuEntry(t,"delRow","Delete Row"+l),t=this._addMenuEntry(t,"delCol","Delete Column"+l),t=this._addMenuSpace(t),t=this._addMenuEntry(t,"cellBgColor","Background Color"),t=this._addMenuEntry(t,"borderColor","Border Color"),t=this._addMenuSpace(t),t=this._addMenuEntry(t,"distributeRows","Distribute Rows"),t=this._addMenuEntry(t,"distributeCols","Distribute Columns"),t=this._addMenuSpace(t),t=this._addMenuEntry(t,"formatCells","Format Cells"),document.body.appendChild(t),r.focus(),this.panel=t}},{key:"destroy",value:function(){this.panel.parentNode.removeChild(this.panel)}},{key:"PerformAction",value:function(e){if(0<this.spreadsheet.selectedNodes.length){var t=this.spreadsheet.selectedNodes.length-1;switch(e){case"addRowAbove":this.AddRow("above",this.spreadsheet.selectedNodes[0]),this.spreadsheet.PushToHistory();break;case"addRowBelow":this.AddRow("below",this.spreadsheet.selectedNodes[t]),this.spreadsheet.PushToHistory();break;case"addColLeft":this.AddColumn("left",this.spreadsheet.selectedNodes[0]),this.spreadsheet.PushToHistory();break;case"addColRight":this.AddColumn("right",this.spreadsheet.selectedNodes[t]),this.spreadsheet.PushToHistory();break;case"delRow":this.DeleteRows(),this.spreadsheet.PushToHistory();break;case"delCol":this.DeleteColumns(),this.spreadsheet.PushToHistory();break;case"cellBgColor":this.ShowPicColorPanel();break;case"borderColor":this.ShowPicBorderColorPanel();break;case"distributeRows":this.DistributeRows(),this.spreadsheet.PushToHistory();break;case"distributeCols":this.DistributeCols(),this.spreadsheet.PushToHistory();break;case"fitToScreen":this.FitToScreen(),this.spreadsheet.PushToHistory();break;case"formatCells":this.OpenFormatCells(),this.spreadsheet.PushToHistory();break;default:return}}}},{key:"HideButKeepAlive",value:function(){this.keepAlive=!0,this.panel.style.display="none"}},{key:"ShowPicColorPanel",value:function(){this.HideButKeepAlive();var t=this;new i(this.event,function(e){t.ChangCellBgColor(e)},-20,6)}},{key:"ChangCellBgColor",value:function(t){this.spreadsheet.selectedNodes.forEach(function(e){e.domElement.style.backgroundColor=t}),this.spreadsheet.PushToHistory()}},{key:"ShowPicBorderColorPanel",value:function(){this.HideButKeepAlive();var t=this;new i(this.event,function(e){t.ChangBorderColor(e)},-20,6)}},{key:"ChangBorderColor",value:function(t){this.spreadsheet.selectedNodes.forEach(function(e){e.domElement.style.border="1px double "+t}),this.spreadsheet.PushToHistory()}},{key:"DistributeRows",value:function(){this.spreadsheet.rootNode.document;var o=this.spreadsheet.tableNode.domElement.getBoundingClientRect().height;this.spreadsheet.tableNode.children.forEach(function(e){var t,n;"tbody"==e.tagName.toLowerCase()&&(t=e.children.length,n=o/t,e.children.forEach(function(e){e.children.forEach(function(e){e.domElement.style.height=n+"px"})}))})}},{key:"DistributeCols",value:function(){this.spreadsheet.rootNode.document;var l=this.spreadsheet.tableNode.domElement.getBoundingClientRect().width;this.spreadsheet.tableNode.children.forEach(function(e){var o,r;"tbody"==e.tagName.toLowerCase()&&(o=!0,r=void 0,e.children.forEach(function(e){var t;o&&(o=!1,t=e.children.length-1,r=l/t);var n=!0;e.children.forEach(function(e){n?n=!1:e.domElement.style.width=r+"px"})}))})}},{key:"AddRow",value:function(e,t){var l=this;this.spreadsheet.DeselectAll(),this.spreadsheet.StopFunctionEditing();var n=this.spreadsheet.GetCoordinatesPerNode(t.id),i=n.row,o=n.row;"above"==e?o=n.row+1:"below"==e&&(i+=1);var a=x.AddRow(i,t.document,this.spreadsheet.GetNumberOfColumns()).tr,r=this.spreadsheet.GetNumberOfRows();i==r?this.spreadsheet.tableNode.children.forEach(function(e){"tbody"==e.tagName.toLowerCase()&&e.Append(a)}):this.spreadsheet.tableNode.children.forEach(function(t){var n,o,r;"tbody"==t.tagName.toLowerCase()&&(o=0,r=!(n=[]),t.children.forEach(function(e){e.children.forEach(function(e){c.a.AdjustAllRowsOnInsert(e,l.spreadsheet,i)}),o==i?(r=!0,n.push(a),o+=2):o++,r&&e.children[0].UpdateTextContent(o),n.push(e)}),t.children=[],n.forEach(function(e){t.Append(e)}))}),this.spreadsheet.Init(),t.GetFirstTextNode().SetFocus(),this.spreadsheet.SelectCell(o,n.col),this.spreadsheet.ShowAutofillHandle()}},{key:"DeleteRows",value:function(){var l=this;this.spreadsheet.StopFunctionEditing();var i=[],a=[];this.spreadsheet.selectedNodes.forEach(function(e){var t;i.indexOf(e.parent.id)<0&&(i.push(e.parent.id),t=l.spreadsheet.GetCoordinatesPerNode(e.id),a.push(t.row))});var e=this.spreadsheet.GetCoordinatesPerNode(this.spreadsheet.selectedNodes[0].id);this.spreadsheet.DeselectAll();var s=this.spreadsheet.rootNode.document;this.spreadsheet.tableNode.children.forEach(function(t){var n,o,r;"tbody"==t.tagName.toLowerCase()&&(o=0,r=!(n=[]),t.children.forEach(function(e){e.children.forEach(function(e){c.a.AdjustAllRowsOnDelete(e,l.spreadsheet,a)}),i.indexOf(e.id)<0?(o++,r&&e.children[0].UpdateTextContent(o),n.push(e)):(s.DeleteNode(e),r=!0)}),t.children=[],n.forEach(function(e){t.Append(e)}))}),this.spreadsheet.Init(),this.spreadsheet.functionsManager.RecalculateAll();try{var t=this.spreadsheet.GetNodePerCoordinates(e.row,e.col);this.spreadsheet.SelectCell(e.row,e.col),t.GetFirstTextNode().SetFocus()}catch(e){}}},{key:"AddColumn",value:function(e,l){var r=this;this.spreadsheet.DeselectAll(),this.spreadsheet.StopFunctionEditing();var t=this.spreadsheet.GetCoordinatesPerNode(l.id),i=parseInt(t.col);"left"==e||"right"==e&&(i=parseInt(t.col+1));var n=this.spreadsheet.GetNumberOfColumns();this.spreadsheet.tableNode.children.forEach(function(e){"thead"==e.tagName.toLowerCase()?i==n?e.children.forEach(function(e){e.Append(x.AddCellColumn(l.document,i))}):e.children.forEach(function(t){var n=[],o=0,r=!1;t.children.forEach(function(e){o==i&&(r=!0,n.push(x.AddCellColumn(l.document,i))),o++,r&&e.UpdateTextContent(x.toColumnName(o)),n.push(e)}),t.children=[],n.forEach(function(e){t.Append(e)})}):"tbody"==e.tagName.toLowerCase()&&(i==n?e.children.forEach(function(e){e.Append(x.AddNormalCell(l.document))}):e.children.forEach(function(t){var n=[],o=0;t.children.forEach(function(e){c.a.AdjustAllColsOnInsert(e,r.spreadsheet,i),o==i&&n.push(x.AddNormalCell(l.document)),o++,n.push(e)}),t.children=[],n.forEach(function(e){t.Append(e)})}))}),this.spreadsheet.Init(),l.GetFirstTextNode().SetFocus(),t=this.spreadsheet.GetCoordinatesPerNode(l.id),this.spreadsheet.SelectCell(t.row,t.col),this.spreadsheet.ShowAutofillHandle()}},{key:"DeleteColumns",value:function(){var r=this;this.spreadsheet.StopFunctionEditing();var i=[];this.spreadsheet.selectedNodes.forEach(function(e){var t=r.spreadsheet.GetCoordinatesPerNode(e.id);i.indexOf(t.col)<0&&i.push(t.col)});var e=this.spreadsheet.GetCoordinatesPerNode(this.spreadsheet.selectedNodes[0].id);this.spreadsheet.DeselectAll();var a=this.spreadsheet.rootNode.document;this.spreadsheet.tableNode.children.forEach(function(e){"thead"==e.tagName.toLowerCase()?e.children.forEach(function(t){var n=[],o=0,r=!1,l=0;t.children.forEach(function(e){-1<i.indexOf(o)?(a.DeleteNode(e),r=!0):(r&&e.UpdateTextContent(x.toColumnName(l)),n.push(e),l++),o++}),t.children=[],n.forEach(function(e){t.Append(e)})}):"tbody"==e.tagName.toLowerCase()&&e.children.forEach(function(t){var n=[],o=0;t.children.forEach(function(e){c.a.AdjustAllColsOnDelete(e,r.spreadsheet,i),-1<i.indexOf(o)?a.DeleteNode(e):n.push(e),o++}),t.children=[],n.forEach(function(e){t.Append(e)})})}),this.spreadsheet.Init(),this.spreadsheet.functionsManager.RecalculateAll();try{var t=this.spreadsheet.GetNodePerCoordinates(e.row,e.col);this.spreadsheet.SelectCell(e.row,e.col),t.GetFirstTextNode().SetFocus()}catch(e){}}},{key:"OpenFormatCells",value:function(){p.a.OpenFormatDialog(this.spreadsheet)}}])&&a(e.prototype,t),n&&a(e,n),o}();function d(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}var h=function(){function n(e,t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,n),this.spreadsheet=e,this.SetPrecision(t)}var e,t,o;return e=n,(t=[{key:"SetPrecision",value:function(e){null==e&&(e=4),this.precision=parseInt(e)}},{key:"_round",value:function(e){return Number(Math.round(e+"e"+this.precision)+"e-"+this.precision)}},{key:"_isNumber",value:function(e){var t=e;return"-"==e[0]&&(t=e.replace("-","")),/^[0-9.]*$/.test(t)}},{key:"LineFitter",value:function(e,t,n){for(var o=2<arguments.length&&void 0!==n?n:"after",r=0,l=0,i=0,a=0,s=0,c=0;c<e.length;c++){var u=e[c];r++,l+=c,i+=c*c,a+=c*u,s+=u}var d=r*i-l*l,h=(i*s-l*a)/d,f=(r*a-l*s)/d,p=new Array;if("after"==o)for(var m=e.length,v=m+t;m<v;)p.push(this._round(h+m*f)),m++;else for(var C=-1,g=C-t;g<C;)p.push(this._round(h+C*f)),C--;return p}},{key:"_debugPrintSet",value:function(e){console.log("----------------------"),e.forEach(function(e){var t="",n="";e.originals.forEach(function(e){t+=e.id+" "}),e.toFill.forEach(function(e){n+=e.id+" "}),console.log("originals: "+t),console.log("toFill: "+n),console.log("")}),console.log("----------------------")}},{key:"PerformAutofill",value:function(){var n,o,r,l,u=this,e=this.spreadsheet.selectedNodes,i=this.spreadsheet.originalNodesForAutofill,d=this.spreadsheet.autofillSelectionDirection,a=[];-1<d.indexOf("row-right")||-1<d.indexOf("row-left")?(n=void 0,o=new Array,r=new Array,e.forEach(function(e){var t=u.spreadsheet.GetCoordinatesPerNode(e.id);null==n&&(n=t.row),n!=t.row&&(n=t.row,a.push({originals:o,toFill:r}),o=new Array,r=new Array),i.indexOf(e.id)<0?r.push(e):o.push(e)}),a.push({originals:o,toFill:r})):(-1<d.indexOf("col-up")||-1<d.indexOf("col-down"))&&(l={},e.forEach(function(e){var t=u.spreadsheet.GetCoordinatesPerNode(e.id);null==l[t.col]&&(l[t.col]={originals:new Array,toFill:new Array}),i.indexOf(e.id)<0?l[t.col].toFill.push(e):l[t.col].originals.push(e)}),Object.keys(l).forEach(function(e){a.push(l[e])})),a.forEach(function(e){var o,t,n,r,l,i=!1,a=!1,s=[],c=[];e.originals.forEach(function(e){var t,n=e.domElement.getAttribute("cell-function"),o=e.domElement.getAttribute("cell-format");c.push(o),null!=n?(a=!0,s.push(n)):(t=e.domElement.textContent,u._isNumber(t)?s.push(parseFloat(t)):(i=!0,s.push(t)))}),1!=s.length||a||(i=!0),i||a?(-1<d.indexOf("row-right")||-1<d.indexOf("col-down")||(-1<d.indexOf("row-left")||-1<d.indexOf("col-up"))&&(e.toFill=e.toFill.reverse(),s=s.reverse()),o=0,e.toFill.forEach(function(e){var t=s[o];null==t&&(t=s[o=0]);var n=c[o];null!=n&&""!=n&&e.domElement.setAttribute("cell-format",n),a?u.spreadsheet.functionsManager.CopyFunctionToNode(t,e):(e.GetFirstTextNode().ForceTextContent(t),p.a.Format(e),u.spreadsheet.functionsManager.CellValueChanged(e)),o++})):(t=e.toFill.length,n="",-1<d.indexOf("row-right")||-1<d.indexOf("col-down")?n="after":(-1<d.indexOf("row-left")||-1<d.indexOf("col-up"))&&(n="before",e.toFill=e.toFill.reverse()),r=u.LineFitter(s,t,n),l=0,e.toFill.forEach(function(e){var t=r[l],n=c[l];null!=n&&""!=n&&e.domElement.setAttribute("cell-format",n),e.GetFirstTextNode().ForceTextContent(t.toString()),p.a.Format(e),u.spreadsheet.functionsManager.CellValueChanged(e),l++}))})}}])&&d(e.prototype,t),o&&d(e,o),n}();function f(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}var m=function(){function t(e){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),this.spreadsheet=e}var e,n,o;return e=t,(n=[{key:"DownloadCsv",value:function(){var e=this.spreadsheet.Export(),o="";e.forEach(function(e){var t="",n=!0;e.forEach(function(e){n?(t=e,n=!1):t+=',"'+e.replace(/"/g,'""')+'"'}),o+=t+"\r\n"});var t=encodeURI("data:text/csv;charset=utf-8,"+o),n=document.createElement("a");n.setAttribute("href",t),n.setAttribute("download","myData.csv"),document.body.appendChild(n),n.click(),document.body.removeChild(n)}},{key:"UploadCsv",value:function(){var o=this;this.input=document.createElement("input"),this.input.type="file",document.body.appendChild(this.input),this.input.addEventListener("change",function(e){var t,n;this.files&&this.files[0]&&(t=this.files[0],(n=new FileReader).addEventListener("load",function(e){var t=e.target.result;o.ImportCsv(t)}),n.readAsBinaryString(t)),o.RemoveInput()}),this.input.click()}},{key:"RemoveInput",value:function(){document.body.removeChild(this.input)}},{key:"ImportCsv",value:function(e){for(var t=this._guessLineEndings(e),n=this._guessDelimiter(e,t),o=[],r=e.split(t),l=0;l<r.length;l++){var i=r[l];"#"!==i.substr(0,1)&&o.push(i.split(n))}this.spreadsheet.Import(o)}},{key:"_guessLineEndings",value:function(e,t){var n=1<arguments.length&&void 0!==t?t:'"';e=e.substr(0,1048576);var o=new RegExp(this._escapeRegExp(n)+"([^]*?)"+this._escapeRegExp(n),"gm"),r=(e=e.replace(o,"")).split("\r"),l=e.split("\n"),i=1<l.length&&l[0].length<r[0].length;if(1===r.length||i)return"\n";for(var a=0,s=0;s<r.length;s++)"\n"===r[s][0]&&a++;return a>=r.length/2?"\r\n":"\r"}},{key:"_escapeRegExp",value:function(e){return e.replace(/[.*+?^${}()|[\]\\]/g,"\\$&")}},{key:"_testEmptyLine",value:function(e){return 1===e.length&&0===e[0].length}},{key:"_guessDelimiter",value:function(e,t){for(var n,o,r,l=[",","\t","|",";",String.fromCharCode(30),String.fromCharCode(31)],i=0;i<l.length;i++){for(var a,s=l[i],c=0,u=0,d=0,h=void 0,f=e.split(t),p=0;p<f.length;p++){this._testEmptyLine(f[p])?d++:(u+=a=f[p].length,void 0!==h?0<a&&(c+=Math.abs(a-h),h=a):h=a)}0<f.length&&(u/=f.length-d),(void 0===o||c<=o)&&(void 0===r||r<u)&&1.99<u&&(o=c,n=s,r=u)}return n}}])&&f(e.prototype,n),o&&f(e,o),t}();function v(e){return(v="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function g(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}function y(e,t,n){return t&&g(e.prototype,t),n&&g(e,n),e}function b(e,t){return(b=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function N(l){var i=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],function(){})),!0}catch(e){return!1}}();return function(){var e,t,n,o,r=E(l);return t=i?(e=E(this).constructor,Reflect.construct(r,arguments,e)):r.apply(this,arguments),n=this,!(o=t)||"object"!==v(o)&&"function"!=typeof o?w(n):o}}function w(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function E(e){return(E=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}var A=function(){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&b(e,t)}(v,C["Plugin"]);var n=N(v);function v(e){var t;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,v),(t=n.call(this,e,!0)).isMouseDown=!1,t.isMouseOnRightBorder=!1,t.isMouseOnBottomBorder=!1,t.currentColResizing=void 0,t.currentRowResizing=void 0,t.startNode=void 0,t.endNode=void 0,t.selectedNodes=[],t.allSelectedRows=new Array,t.allSelectedCols=new Array,t.minSelectedRow=0,t.minSelectedCol=0,t.numberOfRows=0,t.numberOfColumns=0,t.tableNode=void 0,t.autofillHandle=void 0,t.isMovingAutofillHandle=!1,t.originalNodesForAutofill=new Array,t.autofillSelectionDirection="",t.prevPageX=void 0,t.prevPageY=void 0,t.coordinatesPerNode=new Array,t.nodePerCoordinates=new Array,t.autofillManager=new h(w(t)),t.functionsManager=new c.a(w(t)),t.csvManager=new m(w(t)),t.editingFunction=!1,t.readOnly=t.rootNode.document.readOnly,t.InitializeDomElements(),t}return y(v,null,[{key:"GetName",value:function(){return"spreadsheet"}}]),y(v,[{key:"PluginDidMount",value:function(){this.readOnly?this.InitReadOnly():this.Init()}},{key:"InitReadOnly",value:function(){this.HideAutofillHandle(),this.fxInput=this.rootNode.children[0].children[1],null!=this.fxInput&&(this.fxInput.domElement.style.opacity="0.2",this.fxInput.domElement.readOnly=!0)}},{key:"Init",value:function(){"table"==this.rootNode.tagName&&this.TransformTableInSpreadsheet();var n=this;this.HideAutofillHandle(),this.coordinatesPerNode=new Array,this.nodePerCoordinates=new Array,this.coordinatesPerNodeHeader=new Array,this.nodeHeaderPerCoordinates=new Array,this.functionsManager.Reset(),this.fxLabel=this.rootNode.children[0].children[0],this.fxInput=this.rootNode.children[0].children[1];var e=this.rootNode.children[0].children[2].domElement,t=this.rootNode.children[0].children[3].domElement;this._prepareUploadDownloadButtons(t,e),this.functionsManager.SetInputNode(this.fxInput),this.functionsManager.SetFxLabelNode(this.fxLabel);function o(e){n.isMouseDown&&(n.isMouseOnRightBorder?n.ResizeColumn(e):n.isMouseOnBottomBorder&&n.ResizeRow(e))}var r=0,l=0;this.rootNode.parent.domElement.removeEventListener("mousemove",o),this.rootNode.parent.domElement.addEventListener("mousemove",o),this.rootNode.children.forEach(function(e){var t;"table"==e.tagName.toLowerCase()&&(n.tableNode=e,t=n.tableNode.domElement.getAttribute("cm-sh-precision"),n.autofillManager.SetPrecision(t),n.functionsManager.SetPrecision(t),n.tableNode.children.forEach(function(e){"thead"==e.tagName.toLowerCase()?e.children.forEach(function(e){l=0,e.children.forEach(function(e){0<l&&(n.coordinatesPerNodeHeader[l]=e,n.nodeHeaderPerCoordinates[e.id]=l,n.InitHeaderCell(e.id,e.domElement,l)),l++})}):"tbody"==e.tagName.toLowerCase()&&e.children.forEach(function(e){l=0,e.children.forEach(function(e){n.functionsManager.TrackCell(e,r,l),n.InitCell(e.id,e.domElement,r,l),null==n.coordinatesPerNode[r]&&(n.coordinatesPerNode[r]=new Array),n.coordinatesPerNode[r][l]=e,n.nodePerCoordinates[e.id]={col:l,row:r},l++}),r++})}))}),this.numberOfRows=r,this.numberOfColumns=l}},{key:"InitHeaderCell",value:function(e,t){var u=this;null==this.mousedownHeaderFunction&&(this.mousedownHeaderFunction=function(e){var t=u.nodeHeaderPerCoordinates[u.GetNodeFromDom(this).id];u.prevX=e.pageX+window.scrollX,u.prevY=e.pageY+window.scrollY,0==e.button&&(u.isMouseDownHeader=!0,u.startColNode=u.coordinatesPerNodeHeader[t],u.startCol=t,u.endCol=void 0,u.SelectCol(t))}),null==this.mousemoveHeaderFunction&&(this.mousemoveHeaderFunction=function(e){var t,n,o,r,l,i,a,s,c=u.nodeHeaderPerCoordinates[u.GetNodeFromDom(this).id];0==e.button&&u.isMouseDownHeader&&(n=(t=u.startColNode.domElement.getBoundingClientRect()).height,o=t.width,r=t.top,l=t.left,i=e.pageY+window.scrollY,a=e.pageX+window.scrollX,r<i&&i<r+n&&l<a&&a<l+o||(window.getSelection&&document.createRange?(s=window.getSelection()).empty?s.empty():s.removeAllRanges&&s.removeAllRanges():document.selection&&(s=document.selection.createRange()).empty(),u.SelectColOnDrag(c),e.preventDefault()))}),null==this.mouseupHeaderFunction&&(this.mouseupHeaderFunction=function(e){var t=u.nodeHeaderPerCoordinates[u.GetNodeFromDom(this).id];0==e.button&&(u.isMouseDownHeader=!1,u.endNode=u.GetNodeFromDom(this),u.endCol=t,u.ShowAutofillHandle())}),t.removeEventListener("mousedown",this.mousedownHeaderFunction),t.addEventListener("mousedown",this.mousedownHeaderFunction),t.removeEventListener("mousemove",this.mousemoveHeaderFunction),t.addEventListener("mousemove",this.mousemoveHeaderFunction),t.removeEventListener("mouseup",this.mouseupHeaderFunction),t.addEventListener("mouseup",this.mouseupHeaderFunction)}},{key:"InitCell",value:function(e,t){var C=this;null==this.contextmenuFunction&&(this.contextmenuFunction=function(e){var t=C.GetCoordinatesPerNode(C.GetNodeFromDom(this).id);0==C.selectedNodes.length?C.SelectCell(t.row,t.col,!0):1==C.selectedNodes.length&&C.SelectCell(t.row,t.col,!1),C.OpenSettingsPanel(this,e),e.preventDefault(),e.stopPropagation()}),C.clicks=0,C.useArrowsForText=!0,null==this.mousedownFunction&&(this.mousedownFunction=function(e){C.clicks++,1===C.clicks?C.singleClickTimer=setTimeout(function(){C.clicks=0,C.useArrowsForText=!0},300):2===C.clicks&&(clearTimeout(C.singleClickTimer),C.clicks=0,C.useArrowsForText=!1);var t=C.GetCoordinatesPerNode(C.GetNodeFromDom(this).id);C.prevX=e.pageX+window.scrollX,C.prevY=e.pageY+window.scrollY,C.editingFunction&&C.functionsManager.GetIdCurrentCell()==C.GetNodeFromDom(this).id&&C.StopFunctionEditing(),C.editingFunction?(C.isMouseDown=!0,C.startNode=C.GetNodeFromDom(this),C.startNode.row=t.row,C.startNode.col=t.col,C.endNode=void 0,C.SelectCellForFunctionEditing(t.row,t.col,!0)):0==e.button&&(C.isMouseDown=!0,C.startNode=C.GetNodeFromDom(this),C.startNode.row=t.row,C.startNode.col=t.col,C.endNode=void 0,0==t.col?(C.selectingRow=!0,C.SelectRow(t.row)):C.SelectCell(t.row,t.col))}),null==this.mousemoveFunction&&(this.mousemoveFunction=function(e){var t,n,o,r,l,i,a,s,c,u,d,h,f,p,m,v=C.GetCoordinatesPerNode(C.GetNodeFromDom(this).id);C.editingFunction?C.isMouseDown&&(r=(t=C.startNode.domElement.getBoundingClientRect()).height,l=t.width,i=t.top,a=t.left,s=e.pageY+window.scrollY,c=e.pageX+window.scrollX,(i<s&&s<i+r&&a<c&&c<a+l?0:1)&&(window.getSelection&&document.createRange?(u=window.getSelection()).empty?u.empty():u.removeAllRanges&&u.removeAllRanges():document.selection&&(u=document.selection.createRange()).empty(),C.userSelectedOnDrag=!0,C.SelectOnDragForFunctionEditing(v.row,v.col),e.preventDefault())):C.isMovingAutofillHandle?(r=(n=C.startNode.domElement.getBoundingClientRect()).height,l=n.width,i=n.top,a=n.left,s=e.pageY+window.scrollY,c=e.pageX+window.scrollX,(i<s&&s<i+r&&a<c&&c<a+l?0:1)&&(window.getSelection&&document.createRange?(u=window.getSelection()).empty?u.empty():u.removeAllRanges&&u.removeAllRanges():document.selection&&(u=document.selection.createRange()).empty(),C.userSelectedOnDrag=!0,C.SelectForAutofill(e,v.row,v.col),e.preventDefault()),e.preventDefault()):0==e.button&&(C.isMouseDown?C.isMouseOnRightBorder||C.isMouseOnBottomBorder||(r=(o=C.startNode.domElement.getBoundingClientRect()).height,l=o.width,i=o.top,a=o.left,s=e.pageY+window.scrollY,c=e.pageX+window.scrollX,(i<s&&s<i+r&&a<c&&c<a+l?0:1)&&(window.getSelection&&document.createRange?(u=window.getSelection()).empty?u.empty():u.removeAllRanges&&u.removeAllRanges():document.selection&&(u=document.selection.createRange()).empty(),C.userSelectedOnDrag=!0,C.selectingRow?C.SelectRowOnDrag(v.row):C.SelectOnDrag(v.row,v.col),e.preventDefault())):(h=(d=this.getBoundingClientRect()).width,f=d.width-4,e.offsetX>=f&&e.offsetX<=h?(C.isMouseOnRightBorder=!0,C.currentColResizing=v.col,this.style.cursor="col-resize"):(C.isMouseOnRightBorder=!1,C.currentColResizing=void 0,this.style.cursor="auto"),C.isMouseOnRightBorder||(p=d.height,m=d.height-4,e.offsetY>=m&&e.offsetY<=p?(C.isMouseOnBottomBorder=!0,C.currentRowResizing=v.row,this.style.cursor="row-resize"):(C.isMouseOnBottomBorder=!1,C.currentRowResizing=void 0,this.style.cursor="auto"))))}),null==this.mouseupFunction&&(this.mouseupFunction=function(e){var t=C.GetCoordinatesPerNode(C.GetNodeFromDom(this).id);C.selectingRow=!1,C.editingFunction?(C.functionsManager.DoneSelectingCells(),C.fxInput.domElement.focus()):1==C.selectedNodes.length&&C.functionsManager.SetEditingCell(C.selectedNodes[0]),C.isMovingAutofillHandle?(document.body.style.caretColor="auto",C.rootNode.document.RestoreCursorPositionBeforeClick(),C.isMovingAutofillHandle=!1,C.ShowAutofillHandle(),C.autofillManager.PerformAutofill()):0==e.button&&(C.isMouseDown=!1,C.endNode=C.GetNodeFromDom(this),C.endNode.row=t.row,C.endNode.col=t.col,C.userSelectedOnDrag&&(C.userSelectedOnDrag=!1),C.ShowAutofillHandle())}),t.removeEventListener("contextmenu",this.contextmenuFunction),t.addEventListener("contextmenu",this.contextmenuFunction),t.removeEventListener("mousedown",this.mousedownFunction),t.addEventListener("mousedown",this.mousedownFunction),t.removeEventListener("mousemove",this.mousemoveFunction),t.addEventListener("mousemove",this.mousemoveFunction),t.removeEventListener("mouseup",this.mouseupFunction),t.addEventListener("mouseup",this.mouseupFunction)}},{key:"_prepareUploadDownloadButtons",value:function(e,t){var n=this;null==this.uploadCsvFnc&&(this.uploadCsvFnc=function(e){n.csvManager.UploadCsv()}),null==this.downloaCsvFnc&&(this.downloaCsvFnc=function(e){n.csvManager.DownloadCsv()}),e.removeEventListener("click",this.uploadCsvFnc),e.addEventListener("click",this.uploadCsvFnc),t.removeEventListener("click",this.downloaCsvFnc),t.addEventListener("click",this.downloaCsvFnc)}},{key:"PushToHistory",value:function(){this.rootNode.document.PushToHistory()}},{key:"GetCoordinatesPerNode",value:function(e){return this.nodePerCoordinates[e]}},{key:"GetNodePerCoordinates",value:function(e,t){return this.coordinatesPerNode[e][t]}},{key:"GetNumberOfColumns",value:function(){return this.coordinatesPerNode[0].length}},{key:"GetNumberOfRows",value:function(){return this.coordinatesPerNode.length}},{key:"GetValue",value:function(e,t){var n=(n=this.GetNodePerCoordinates(e,t).domElement.textContent).replace(" ",""),o=parseFloat(n);return isNaN(o)?n:o}},{key:"GetValues",value:function(e,t,n,o){var r=[];o+=1;for(var l=0;l<=this.coordinatesPerNode.length;l++)if(e<=l&&l<=n)for(var i,a,s=0;s<=this.coordinatesPerNode[l].length;s++){t<=s&&s<o&&(i=this.GetNodePerCoordinates(l,s).domElement.textContent.replace(" ",""),a=parseFloat(i),isNaN(a)?r.push(i):r.push(a))}return r}},{key:"HideAutofillHandle",value:function(){null!=this.autofillHandle&&null!=this.autofillHandle.parentNode&&this.autofillHandle.parentNode.removeChild(this.autofillHandle),this.autofillHandle=void 0}},{key:"ShowAutofillHandle",value:function(){var e,t,n,o;0<this.selectedNodes.length&&!this.editingFunction&&(null==this.startNode&&(this.startNode=this.selectedNodes[0]),this.autofillHandle=document.createElement("div"),this.autofillHandle.setAttribute("class","csTableAutofillHandle"),this.autofillHandle.setAttribute("contentEditable","false"),e=this.selectedNodes.length-1,t=this.selectedNodes[e].domElement.getBoundingClientRect(),n=this.rootNode.domElement.getBoundingClientRect(),this.autofillHandle.style.top=t.top-n.top+t.height-3+"px",this.autofillHandle.style.left=t.left+t.width-n.left-3+"px",(o=this).autofillHandle.addEventListener("mousedown",function(e){document.body.style.caretColor="transparent",o.prevPageX=e.pageX,o.prevPageY=e.pageY,o.rootNode.document.SaveCursorPositonBeforeClick(),o.isMovingAutofillHandle=!0,o.allSelectedRows=new Array,o.allSelectedCols=new Array,o.minSelectedRow=void 0,o.minSelectedCol=void 0,o.originalNodesForAutofill=new Array,o.selectedNodes.forEach(function(e){o.originalNodesForAutofill.push(e.id);var t=o.GetCoordinatesPerNode(e.id);o.allSelectedRows.indexOf(t.row)<0&&(o.allSelectedRows.push(t.row),(null==o.minSelectedRow||o.minSelectedRow>t.row)&&(o.minSelectedRow=t.row)),o.allSelectedCols.indexOf(t.col)<0&&(o.allSelectedCols.push(t.col),(null==o.minSelectedCol||o.minSelectedCol>t.col)&&(o.minSelectedCol=t.col))})}),this.autofillHandle.addEventListener("mouseup",function(e){document.body.style.caretColor="auto",o.isMovingAutofillHandle=!1,o.rootNode.document.RestoreCursorPositionBeforeClick()}),this.rootNode.domElement.appendChild(this.autofillHandle))}},{key:"ResizeRow",value:function(r){var e,t,l,i,a;null!=this.currentRowResizing&&(window.getSelection&&document.createRange?(e=window.getSelection()).empty?e.empty():e.removeAllRanges&&e.removeAllRanges():document.selection&&(e=document.selection.createRange()).empty(),i=!(t=0),a=0,(l=this).tableNode.children.forEach(function(e){"tbody"==e.tagName.toLowerCase()&&(t=0,e.children.forEach(function(e){t==l.currentRowResizing&&e.children.forEach(function(e){var t,n,o;i&&(t=e.domElement.getBoundingClientRect(),o=(n=r.pageY)-l.prevY,a=t.height+o,l.prevY=n,i=!1),e.domElement.style.height=a+"px"}),t++}))}))}},{key:"ResizeColumn",value:function(l){var e,i,a,s,c,u,d;null!=this.currentColResizing&&(window.getSelection&&document.createRange?(e=window.getSelection()).empty?e.empty():e.removeAllRanges&&e.removeAllRanges():document.selection&&(e=document.selection.createRange()).empty(),u=c=i=0,d=!(s=!0),(a=this).tableNode.children.forEach(function(e){"tbody"==e.tagName.toLowerCase()&&e.children.forEach(function(e){i=0,e.children.forEach(function(e){var t,n,o,r;i==a.currentColResizing&&(s&&(t=e.domElement.getBoundingClientRect(),o=(n=l.pageX)-a.prevX,c=t.width+o,a.prevX=n,null!=e.next&&(d=!0,r=e.next.domElement.getBoundingClientRect(),u=r.width-o),s=!1),e.domElement.style.width=c+"px",d&&null!=e.next&&(e.next.domElement.style.width=u+"px")),i++})})}))}},{key:"SelectRowOnDrag",value:function(t){var n,o,r,l,i;(null==this.endNode?this.startNode.row:this.endNode.row)!=t&&(this.DeselectAll(),n="up",(o=this.startNode.row)<=t&&(n="down"),l=r=0,(i=this).tableNode.children.forEach(function(e){"tbody"==e.tagName.toLowerCase()&&e.children.forEach(function(e){l=0,e.children.forEach(function(e){"down"==n?o<=r&&r<=t&&i.SelectCell(r,l,!0):"up"==n&&t<=r&&r<=o&&i.SelectCell(r,l,!0),l++}),r++})}))}},{key:"SelectColOnDrag",value:function(t){var n,o,r,l,i;(null==this.endCol?this.startCol:this.endCol)!=t&&(this.DeselectAll(),n="left",(o=this.startCol)<=t&&(n="right"),l=r=0,(i=this).tableNode.children.forEach(function(e){"tbody"==e.tagName.toLowerCase()&&e.children.forEach(function(e){l=0,e.children.forEach(function(e){"right"==n?o<=l&&l<=t&&i.SelectCell(r,l,!0):"left"==n&&t<=l&&l<=o&&i.SelectCell(r,l,!0),l++}),r++})}))}},{key:"SelectRow",value:function(t,e){null!=e&&0!=e||this.DeselectAll();var n=0,o=this;this.tableNode.children.forEach(function(e){"tbody"==e.tagName.toLowerCase()&&e.children.forEach(function(e){e.children.forEach(function(e){n==t&&e.domElement.className.indexOf("commaSpreadsheetCellCounter")<0&&(e.domElement.className="commaSpreadsheetCellSelected",o.selectedNodes.push(e)),0}),n++})})}},{key:"SelectCol",value:function(t,e){null!=e&&0!=e||this.DeselectAll();var n=0,o=this;this.tableNode.children.forEach(function(e){"tbody"==e.tagName.toLowerCase()&&e.children.forEach(function(e){n=0,e.children.forEach(function(e){n==t&&e.domElement.className.indexOf("commaSpreadsheetCellCounter")<0&&(e.domElement.className="commaSpreadsheetCellSelected",o.selectedNodes.push(e)),n++}),0})})}},{key:"SelectCell",value:function(t,n,e,o){var r=3<arguments.length&&void 0!==o&&o;null!=e&&0!=e||this.DeselectAll();var l=0,i=0,a=this;this.tableNode.children.forEach(function(e){"tbody"==e.tagName.toLowerCase()&&e.children.forEach(function(e){i=0,e.children.forEach(function(e){l==t&&i==n&&e.domElement.className.indexOf("commaSpreadsheetCellCounter")<0&&(e.domElement.className=r?"commaSpreadsheetCellAutofillSelected":"commaSpreadsheetCellSelected",a.selectedNodes.push(e)),i++}),l++})})}},{key:"DeselectAll",value:function(){this.StopFunctionEditing(),this.HideAutofillHandle(),this.selectedNodes=[],null!=this.tableNode&&this.tableNode.children.forEach(function(e){"tbody"==e.tagName.toLowerCase()&&e.children.forEach(function(e){e.children.forEach(function(e){e.domElement.className.indexOf("commaSpreadsheetCellCounter")<0&&(e.domElement.className="commaSpreadsheetCell")})})})}},{key:"SelectOnDrag",value:function(t,n){var o,r,l,i,a,s,e=0,c=0,c=null==this.endNode?(e=this.startNode.row,this.startNode.col):(e=this.endNode.row,this.endNode.col);e==t&&c==n||(this.DeselectAll(),l="left",o=this.startNode.row,r=this.startNode.col,l=o<=t&&r<=n?"right":t<=o&&r<n?"topRight":o<=t&&n<=r?"bottomLeft":"left",a=i=0,(s=this).tableNode.children.forEach(function(e){"tbody"==e.tagName.toLowerCase()&&e.children.forEach(function(e){a=0,e.children.forEach(function(e){"right"==l?o<=i&&i<=t&&r<=a&&a<=n&&s.SelectCell(i,a,!0):"left"==l?t<=i&&i<=o&&n<=a&&a<=r&&s.SelectCell(i,a,!0):"topRight"==l?i<=o&&t<=i&&r<=a&&a<=n&&s.SelectCell(i,a,!0):"bottomLeft"==l&&o<=i&&i<=t&&a<=r&&n<=a&&s.SelectCell(i,a,!0),a++}),i++})}))}},{key:"SelectForAutofill",value:function(e,t,n){this.DeselectAll();var o=e.pageX,r=e.pageY,l=o-this.prevPageX,i=r-this.prevPageY,a="",a=Math.abs(l)<Math.abs(i)?0<i?"col-down":"col-up":0<l?"row-right":"row-left";this.autofillSelectionDirection=a;var s=0,c=0,u=this;this.tableNode.children.forEach(function(e){"tbody"==e.tagName.toLowerCase()&&e.children.forEach(function(e){s=0,e.children.forEach(function(e){"row-left"==a?-1<u.allSelectedRows.indexOf(c)&&(-1<u.allSelectedCols.indexOf(s)||s<=u.minSelectedCol&&n<=s)&&u.SelectCell(c,s,!0,!0):"row-right"==a?-1<u.allSelectedRows.indexOf(c)&&(-1<u.allSelectedCols.indexOf(s)||s>=u.minSelectedCol&&s<=n)&&u.SelectCell(c,s,!0,!0):"col-down"==a?-1<u.allSelectedCols.indexOf(s)&&(-1<u.allSelectedRows.indexOf(c)||c>=u.minSelectedRow&&c<=t)&&u.SelectCell(c,s,!0,!0):"col-up"==a&&-1<u.allSelectedCols.indexOf(s)&&(-1<u.allSelectedRows.indexOf(c)||c<=u.minSelectedRow&&t<=c)&&u.SelectCell(c,s,!0,!0),s++}),c++})})}},{key:"SelectOnDragForFunctionEditing",value:function(t,n){this.DeselectAllForFunctionEditing(),this.functionsManager.ClearCurrentRange();var o,r,l,i,a,s,e=0,c=0,c=null==this.endNode?(e=this.startNode.row,this.startNode.col):(e=this.endNode.row,this.endNode.col);e==t&&c==n||(l="left",o=this.startNode.row,r=this.startNode.col,l=o<=t&&r<=n?"right":t<=o&&r<n?"topRight":o<=t&&n<=r?"bottomLeft":"left",a=i=0,(s=this).tableNode.children.forEach(function(e){"tbody"==e.tagName.toLowerCase()&&e.children.forEach(function(e){a=0,e.children.forEach(function(e){"right"==l?o<=i&&i<=t&&r<=a&&a<=n&&s.SelectCellForFunctionEditing(i,a):"left"==l?t<=i&&i<=o&&n<=a&&a<=r&&s.SelectCellForFunctionEditing(i,a):"topRight"==l?i<=o&&t<=i&&r<=a&&a<=n&&s.SelectCellForFunctionEditing(i,a):"bottomLeft"==l&&o<=i&&i<=t&&a<=r&&n<=a&&s.SelectCellForFunctionEditing(i,a),a++}),i++})}))}},{key:"SelectCellForFunctionEditing",value:function(t,n,e){var o=0,r=0,l=this;2<arguments.length&&void 0!==e&&e&&(this.useHighlightClass=this.functionsManager.StartSelectingCells());var i=this.functionsManager.GetCurrentCell(),a=this.GetCoordinatesPerNode(i.id);a.row==t&&a.col==n||this.tableNode.children.forEach(function(e){"tbody"==e.tagName.toLowerCase()&&e.children.forEach(function(e){r=0,e.children.forEach(function(e){o==t&&r==n&&e.domElement.className.indexOf("commaSpreadsheetCellCounter")<0&&(e.domElement.className=l.useHighlightClass,l.functionsManager.AddCell(t,n)),r++}),o++})})}},{key:"DeselectAllForFunctionEditing",value:function(){null!=this.tableNode&&this.tableNode.children.forEach(function(e){"tbody"==e.tagName.toLowerCase()&&e.children.forEach(function(e){e.children.forEach(function(e){e.domElement.className.indexOf("commaSpreadsheetCellCounter")<0&&-1<e.domElement.className.indexOf("cscfe_highlight_cell")&&(e.domElement.className="commaSpreadsheetCell")})})})}},{key:"SelectRangeForFunctionEditing",value:function(e,t,n,o,r){if(null==n){var l=this.GetNodePerCoordinates(e,t);l.domElement.className.indexOf("commaSpreadsheetCellCounter")<0&&(l.domElement.className=r)}else{o+=1;for(var i=0;i<=this.coordinatesPerNode.length;i++)if(e<=i&&i<=n)for(var a,s=0;s<=this.coordinatesPerNode[i].length;s++){t<=s&&s<o&&((a=this.GetNodePerCoordinates(i,s)).domElement.className.indexOf("commaSpreadsheetCellCounter")<0&&(a.domElement.className=r))}}}},{key:"DeselectRangeForFunctionEditing",value:function(e,t,n,o,r,l,i,a,s){if(null==n){var c;!(r&&e==l&&t==i?!1:!0)||(c=this.GetNodePerCoordinates(e,t)).domElement.className.indexOf("commaSpreadsheetCellCounter")<0&&-1<c.domElement.className.indexOf("cscfe_highlight_cell")&&(c.domElement.className="commaSpreadsheetCell")}else{o+=1;for(var u=0;u<=this.coordinatesPerNode.length;u++)if(e<=u&&u<=n)for(var d,h=0;h<=this.coordinatesPerNode[u].length;h++){t<=h&&h<o&&(!(r&&l<=u&&u<=a&&i<=h&&h<s?!1:!0)||(d=this.GetNodePerCoordinates(u,h)).domElement.className.indexOf("commaSpreadsheetCellCounter")<0&&-1<d.domElement.className.indexOf("cscfe_highlight_cell")&&(d.domElement.className="commaSpreadsheetCell"))}}}},{key:"StartFunctionEditing",value:function(e){this.editingFunction||(null==e&&(e=this.rootNode.document.GetNodeAtCursor().parent.parent),this.editingFunction=!0,this.fxLabel.domElement.style.color="#FFC15E",this.functionsManager.StartEditingCell(e))}},{key:"StopFunctionEditing",value:function(e){0<arguments.length&&void 0!==e&&e&&this.functionsManager.GetCurrentCell().GetFirstTextNode().SetFocus(),null!=this.fxLabel&&(this.fxLabel.domElement.style.color="#FFFFFF"),this.editingFunction=!1,this.functionsManager.StopEditingCell(),this.DeselectAllForFunctionEditing()}},{key:"OpenSettingsPanel",value:function(e,t){this.cellSettingsPanel=new u(this,e,t)}},{key:"CloseSettingsPanel",value:function(e){console.log(e)}},{key:"GetNodeFromDom",value:function(e){var t=e.getAttribute("cm-id");return this.rootNode.document.GetNodeById(t)}},{key:"ApplyStyleOnSelectedLines",value:function(t,n){this.selectedNodes.forEach(function(e){e.children.forEach(function(e){e.isBlockNode()&&e.ToggleStyle(t,n,!0)})})}},{key:"_applyToTextNodes",value:function(e,t,n){var o;e.isTextNode()&&e.ToggleStyle(t,n,!0),null!=e.children&&(o=this,e.children.forEach(function(e){o._applyToTextNodes(e,t,n)}))}},{key:"ApplyStyleOnSelectedCells",value:function(t,n){var o=this;this.selectedNodes.forEach(function(e){o._applyToTextNodes(e,t,n)})}},{key:"DeleteContentOfSelectedCells",value:function(e){var t=0<arguments.length&&void 0!==e&&e,o=this.rootNode.document,r=void 0;this.selectedNodes.forEach(function(e){c.a.RemoveFunction(e);var t,n=e.children[0];n.children.forEach(function(e){t=e.nodeStyle.Copy(),o.DeleteNode(e,!1,!0,t)}),r=e.GetFirstTextNode()}),t&&null!=r&&r.SetFocus()}},{key:"_fintTDContainer",value:function(e){return null!=e.parent?"td"==e.parent.tagName?e.parent:this._fintTDContainer(e.parent):void 0}},{key:"MoveToNextCell",value:function(){var e,t=this.rootNode.document.GetNodeAtCursor();null!=t&&t.isTextNode()&&(e=this._fintTDContainer(t),this.MoveCellFocus("RIGHT",e))}},{key:"MoveAndSelectCellFocus",value:function(){}},{key:"MoveCellFocus",value:function(e,t){var n,o=this.GetCoordinatesPerNode(t.id),r=void 0,l=void 0,i=void 0;"RIGHT"==e?(l=o.col+1,i=o.row,null==(r=this.GetNodePerCoordinates(i,l))&&((i+=l=1)>=this.GetNumberOfRows()&&(--i,l=this.GetNumberOfColumns()-1),r=this.GetNodePerCoordinates(i,l))):"LEFT"==e?(l=o.col-1,i=o.row,l<1&&(l=this.GetNumberOfColumns()-1,--i<0&&(i=0,l=1)),r=this.GetNodePerCoordinates(i,l)):"DOWN"==e?(l=o.col,(i=o.row+1)>=this.GetNumberOfRows()&&--i,r=this.GetNodePerCoordinates(i,l)):"UP"==e&&(l=o.col,(i=o.row-1)<0&&(i=0),r=this.GetNodePerCoordinates(i,l)),null!=r&&((n=r.GetFirstTextNode()).SelectText(0,n.text.toString().length),this.SelectCell(i,l),this.functionsManager.SetEditingCell(this.selectedNodes[0]),this.ShowAutofillHandle())}},{key:"SelectAll",value:function(){this.DeselectAll();var t=0,n=0,o=this;this.tableNode.children.forEach(function(e){"tbody"==e.tagName.toLowerCase()&&e.children.forEach(function(e){n=0,e.children.forEach(function(e){o.SelectCell(t,n,!0),n++}),t++})})}},{key:"AddSelectedCellsToClipboard",value:function(e){var t=0<arguments.length&&void 0!==e&&e,n=this.rootNode.document,o=C.BlockNode.CreateNew(n,"table");o.SetAttributes([{name:"class",value:"commaSpreadsheetTable"}]),o.SetPluginType(this.rootNode.GetPluginType());var r=C.BlockNode.CreateNew(n,"tbody"),l=this,i=void 0,a=void 0;this.selectedNodes.forEach(function(e){var t=l.GetCoordinatesPerNode(e.id);a!=t.row&&(null!=i&&r.Append(i),a=t.row,i=C.BlockNode.CreateNew(n,"tr")),i.Append(e.Copy())}),null!=i&&r.Append(i),o.Append(r),t&&this.DeleteContentOfSelectedCells(),this.rootNode.document.ForceClipboardContent(o.domElement)}},{key:"PasteCells",value:function(e){var t,n,o,l,r=!1,i=this,a=(new DOMParser).parseFromString(e,"text/html").body.firstElementChild;return null==a||null!=(t=[].slice.call(a.getElementsByTagName("tr")))&&0<t.length&&(r=!0,n=this.selectedNodes[0],o=this.GetCoordinatesPerNode(n.id),l=o.row,t.forEach(function(e){var r=o.col;[].slice.call(e.getElementsByTagName("td")).forEach(function(e){var t,n,o;r<i.GetNumberOfColumns()&&l<i.GetNumberOfRows()&&(null!=(t=i.GetNodePerCoordinates(l,r))&&(n=t.GetFirstTextNode(),null==(o=i.functionsManager.GetFunctionFromDomNode(e))||""==o?(n.ForceTextContent(e.textContent.toString()),p.a.Format(t)):i.functionsManager.CopyFunctionToNode(o,t))),r++}),l++})),r&&(this.functionsManager.RecalculateAll(),this.PushToHistory()),r}},{key:"Fire",value:function(e,t,n,o){var r=JSON.parse(JSON.stringify(e));e==C.PluginActions.NEW_CHAR_ADDED&&"Backspace"==o.key&&1<this.selectedNodes.length&&(r=C.PluginActions.DELETE);var l,i,a,s,c,u=!1,d=this,h=void 0;switch(r){case C.PluginActions.LOST_FOCUS:this.DeselectAll(),this.StopFunctionEditing();break;case C.PluginActions.BEFORE_PASTE:var f=o.clipboardData.getData("text/html");null!=f&&""!=f||(f=o.clipboardData.getData("text")),u=this.PasteCells(f);break;case C.PluginActions.BEFORE_COPY:this.AddSelectedCellsToClipboard(),u=!0;break;case C.PluginActions.BEFORE_CUT:this.AddSelectedCellsToClipboard(!0),u=!0;break;case C.PluginActions.SELECT_ALL:this.SelectAll(),u=!0;break;case C.PluginActions.SHIFT_DOWN:case C.PluginActions.SHIFT_UP:break;case C.PluginActions.ARROW_UP:null!=t&&null!=t.parent&&("td"==t.parent.tagName?h=t.parent:null!=t.parent.parent&&"td"==t.parent.parent.tagName&&(h=t.parent.parent)),null!=h&&(d.MoveCellFocus("UP",h),u=!0);break;case C.PluginActions.ARROW_DOWN:null!=t&&null!=t.parent&&("td"==t.parent.tagName?h=t.parent:null!=t.parent.parent&&"td"==t.parent.parent.tagName&&(h=t.parent.parent)),null!=h&&(d.MoveCellFocus("DOWN",h),u=!0);break;case C.PluginActions.ARROW_LEFT:null!=t&&null!=t.parent&&("td"==t.parent.tagName?h=t.parent:null!=t.parent.parent&&"td"==t.parent.parent.tagName&&(h=t.parent.parent)),null!=h&&(l=!0,d.useArrowsForText&&(l=!1,null!=(i=h.domElement.textContent.replace(/[\u200B-\u200D\uFEFF]/g,""))&&""!=i&&0!=h.document.GetCursorPosition().startOffset||(l=!0)),l&&(d.MoveCellFocus("LEFT",h),u=!0));break;case C.PluginActions.ARROW_RIGHT:null!=t&&null!=t.parent&&("td"==t.parent.tagName?h=t.parent:null!=t.parent.parent&&"td"==t.parent.parent.tagName&&(h=t.parent.parent)),null!=h&&(a=!0,d.useArrowsForText&&(a=!1,null!=(s=h.domElement.textContent.replace(/[\u200B-\u200D\uFEFF]/g,""))&&""!=s&&h.document.GetCursorPosition().startOffset!=s.length||(a=!0)),a&&(d.MoveCellFocus("RIGHT",h),u=!0));break;case C.PluginActions.SHIFT_ARROW_UP:case C.PluginActions.SHIFT_ARROW_DOWN:case C.PluginActions.SHIFT_ARROW_LEFT:case C.PluginActions.SHIFT_ARROW_RIGHT:break;case C.PluginActions.ENTER:u=!0,null!=t&&null!=t.parent&&("td"==t.parent.tagName?h=t.parent:null!=t.parent.parent&&"td"==t.parent.parent.tagName&&(h=t.parent.parent)),null!=h&&d.MoveCellFocus("DOWN",h);break;case C.PluginActions.NEW_CHAR_ADDED:null!=t&&null!=t.parent&&null!=t.parent.parent&&"td"==t.parent.parent.tagName&&("="==t.parent.parent.domElement.textContent?(t.ForceTextContent(""),this.StartFunctionEditing(t.parent.parent)):(c=t.parent.parent,null==d.prevTimeoutOnTyping&&(d.prevTimeoutOnTyping={}),null!=d.prevTimeoutOnTyping[c.id]&&clearTimeout(d.prevTimeoutOnTyping[c.id]),d.prevTimeoutOnTyping[c.id]=setTimeout(function(){p.a.Format(c),d.functionsManager.CellValueChanged(c)},2e3)));break;case C.PluginActions.APPLY_STYLE_ON_LINE:null==t&&this.ApplyStyleOnSelectedLines(o.styleName,o.value);break;case C.PluginActions.APPLY_STYLE_ON_TEXT:null==t&&this.ApplyStyleOnSelectedCells(o.styleName,o.value);break;case C.PluginActions.DELETE:this.editingFunction||(this.DeleteContentOfSelectedCells(!0),u=!0);break;case C.PluginActions.CANCEL_FROM_TOP:u=!0;break;case C.PluginActions.DELETE_FROM_BOTTOM:this.rootNode.document.DeleteNode(this.rootNode),n.DeletePluginInstance(this),u=!1;break;case C.PluginActions.TAB:this.MoveToNextCell(),u=!0;break;default:return}return u}},{key:"AddRows",value:function(e){for(var n=this,o=0;o<e;)!function(){var t=v.AddRow(n.GetNumberOfRows()+o,n.rootNode.document,n.GetNumberOfColumns()).tr;n.tableNode.children.forEach(function(e){"tbody"==e.tagName.toLowerCase()&&e.Append(t)}),o++}();this.Init()}},{key:"AddColumns",value:function(e){for(var n=this,o=this.rootNode.document,r=0;r<e;)!function(){var t=n.GetNumberOfColumns()+r;n.tableNode.children.forEach(function(e){"thead"==e.tagName.toLowerCase()?e.children.forEach(function(e){e.Append(v.AddCellColumn(o,t))}):"tbody"==e.tagName.toLowerCase()&&e.children.forEach(function(e){e.Append(v.AddNormalCell(o))})}),r++}();this.Init()}},{key:"TransformTableInSpreadsheet",value:function(){var e=this.rootNode,t=this,n=this.id,o=this.rootNode.GetPluginType(),r=e.document,l=e.InsertEmptyBlockNodeBefore("div");l.SetAttributes([{name:"class",value:"spreadsheetContainer"}]),l.SetPluginType(o),l.Append(v.CreateHeader(r));var i=C.BlockNode.CreateNew(r,"table",void 0,[{name:"class",value:"commaSpreadsheetTable"}]),a=0,s=[];e.children.forEach(function(e){"tbody"==e.tagName?e.children.forEach(function(e){0==a&&(a=e.children.length),s.push(e)}):"tr"==e.tagName&&(0==a&&(a=e.children.length),s.push(e))});var c=C.BlockNode.CreateNew(r,"thead"),u=v.AddColsCounterRow(r,a+1);c.Append(u),i.Append(c);var d=C.BlockNode.CreateNew(r,"tbody"),h=void 0,f=1;s.forEach(function(e){var t=C.BlockNode.CreateNew(r,"td",void 0,[],!0,f);t.SetAttributes([{name:"class",value:"commaSpreadsheetCellCounter csRowCounterCell"}]),t.SetAttributes([{name:"contentEditable",value:!1}]),null==h&&(h=e.children[0].GetFirstTextNode()),e.Append(t,0),d.Append(e),f++}),i.Append(d),l.Append(i),r.DeleteNode(e);var p=l.InsertEmptyBlockNodeAfter("div"),m=C.TextNode.CreateNew(r,"span","");m.ToggleStyle("fontColor","#475666"),p.Append(m),this.rootNode=l,this.id=l.id,r.ChangePluginInstanceId(n,l.id),setTimeout(function(){h.SetFocus(),t.SelectCell(0,1),t.ShowAutofillHandle()},100)}},{key:"Import",value:function(e){var t,r,n,l,o,i,a,s,c;0<e.length&&(r=(t=this).rootNode.document,n=e[0].length,l=void 0,o=C.BlockNode.CreateNew(r,"table",void 0,[{name:"class",value:"commaSpreadsheetTable"}]),i=C.BlockNode.CreateNew(r,"thead"),a=v.AddColsCounterRow(r,n+1),i.Append(a),o.Append(i),s=C.BlockNode.CreateNew(r,"tbody"),c=1,e.forEach(function(e){var n=C.BlockNode.CreateNew(r,"tr"),o=0;e.forEach(function(e){var t=void 0;0==o?t=v.AddCell(r,!0,!1,c):(t=v.AddCell(r)).td.GetFirstTextNode().ForceTextContent(e),null==l&&(l=t.nodeForFocus),n.Append(t.td),o++}),s.Append(n),c++}),o.Append(s),r.DeleteNode(this.tableNode),this.rootNode.Append(o),this.Init(),setTimeout(function(){l.SetFocus(),t.SelectCell(0,1),t.ShowAutofillHandle()},100))}},{key:"Export",value:function(){var o=[];return this.tableNode.children.forEach(function(e){"tbody"==e.tagName.toLowerCase()&&e.children.forEach(function(e){var t=[],n=!0;e.children.forEach(function(e){n?n=!1:t.push(e.domElement.textContent.replace(/^[\s\uFEFF\xA0]+|[\s\uFEFF\xA0]+$/g,""))}),o.push(t)})}),o}}],[{key:"toColumnName",value:function(e){for(var t="",n=1,o=26;0<=(e-=n);n=o,o*=26)t=String.fromCharCode(parseInt(e%o/n)+65)+t;return t}},{key:"AddRow",value:function(e,t,n){for(var o=C.BlockNode.CreateNew(t,"tr"),r=0,l=void 0;r<n;){var i=void 0,i=0==r?v.AddCell(t,!0,!1,e):v.AddCell(t);null==l&&(l=i.nodeForFocus),o.Append(i.td),r++}return{tr:o,nodeForFocus:l}}},{key:"AddColsCounterRow",value:function(e,t){for(var n=C.BlockNode.CreateNew(e,"tr"),o=0;o<t;){var r=void 0,r=0==o?v.AddCell(e,!1,!0,"",!0):v.AddCell(e,!1,!0,v.toColumnName(o));n.Append(r.td),o++}return n}},{key:"AddCellColumn",value:function(e,t){return v.AddCell(e,!1,!0,v.toColumnName(t)).td}},{key:"AddNormalCell",value:function(e){return v.AddCell(e,!1,!1,"",!0).td}},{key:"AddCell",value:function(e,t,n,o,r){var l=1<arguments.length&&void 0!==t&&t,i=2<arguments.length&&void 0!==n&&n,a=3<arguments.length&&void 0!==o?o:0,s=4<arguments.length&&void 0!==r&&r,c=void 0,c=i?C.BlockNode.CreateNew(e,"th",void 0,[],!0,a):l?(a+=1,C.BlockNode.CreateNew(e,"td",void 0,[],!0,a)):C.BlockNode.CreateNew(e,"td");l||i?(c.SetAttributes([{name:"class",value:"commaSpreadsheetCellCounter"}]),(l||s)&&c.SetAttributes([{name:"class",value:"commaSpreadsheetCellCounter csRowCounterCell"}])):c.SetAttributes([{name:"class",value:"commaSpreadsheetCell"}]);var u,d,h=void 0;return l||i?c.SetAttributes([{name:"contentEditable",value:!1}]):(u=C.BlockNode.CreateNew(e,"div"),d=e.GetDefaultNodeStyle(),(h=C.TextNode.CreateNew(e,"span","",d)).ToggleStyle("fontColor","#475666"),u.Append(h),c.Append(u)),{td:c,nodeForFocus:h}}},{key:"CreateHeader",value:function(e){var t=C.BlockNode.CreateNew(e,"div",void 0,[{name:"class",value:"functContainer"},{name:"contentEditable",value:!1}]),n=C.BlockNode.CreateNew(e,"div",void 0,[{name:"class",value:"functBoxFxLabel"}],!0,"f(x)");t.Append(n);var o=C.BlockNode.CreateNew(e,"input",void 0,[{name:"class",value:"functInputBox"}]);t.Append(o);var r=C.BlockNode.CreateNew(e,"i",void 0,[{name:"class",value:"fa fa-download cscfe_functBtn"},{name:"title",value:"Export as CSV"}]);t.Append(r);var l=C.BlockNode.CreateNew(e,"i",void 0,[{name:"class",value:"fa fa-upload cscfe_functBtn"},{name:"title",value:"Import CSV"}]);return t.Append(l),t}},{key:"CreateNew",value:function(e,t){t.cols=JSON.parse(t.cols)+1;e.GetStyleAtCurrentCursorPosition();var n=e.GetDefaultNodeStyle(),o=e.GetNodeAtCursor().GetBlockContainer().InsertEmptyBlockNodeAfter("div");o.SetAttributes([{name:"class",value:"spreadsheetContainer"}]),o.Append(v.CreateHeader(e));var r=C.BlockNode.CreateNew(e,"table",void 0,[{name:"class",value:"commaSpreadsheetTable"}]),l=C.BlockNode.CreateNew(e,"thead"),i=v.AddColsCounterRow(e,t.cols);l.Append(i),r.Append(l);for(var a=C.BlockNode.CreateNew(e,"tbody"),s=t.rows,c=void 0,u=0;u<s;){var d=v.AddRow(u,e,t.cols);null==c&&(c=d.nodeForFocus),a.Append(d.tr),u++}r.Append(a),o.Append(r);var h=o.InsertEmptyBlockNodeAfter("div"),f=C.TextNode.CreateNew(e,"span","",n.Copy());f.ToggleStyle("fontColor","#475666"),h.Append(f);var p=new v(o);return setTimeout(function(){c.SetFocus(),p.SelectCell(0,1),p.ShowAutofillHandle()},100),p}}]),v}(),x=t.default=A}],e={},f.m=d,f.c=e,f.d=function(e,t,n){f.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:n})},f.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},f.t=function(t,e){if(1&e&&(t=f(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var n=Object.create(null);if(f.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var o in t)f.d(n,o,function(e){return t[e]}.bind(null,o));return n},f.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return f.d(t,"a",t),t},f.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},f.p="/",f(f.s=3);function f(t){if(e[t])return e[t].exports;var n=e[t]={i:t,l:!1,exports:{}};return d[t].call(n.exports,n,n.exports,f),n.l=!0,n.exports}var d,e});